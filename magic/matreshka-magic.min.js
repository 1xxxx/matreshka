/*
	Matreshka Magic v1.1.0-alpha.1 (2015-09-13), the part of Matreshka project 
	JavaScript Framework by Andrey Gubanov
	Released under the MIT license
	More info: http://matreshka.io/#magic
*/

!function(a){var b,c,d,e,f,g,h;b=function(){!function(a,b,c,d){b[c]||(Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){b=b||a.event,b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(window,document,"addEventListener","removeEventListener")}(),c=function(a,b,c,d,e,f,g,h,i,j,k,l){return l=function(a,b){return new l.i(a,b)},l.i=function(d,e){c.push.apply(this,d?d.nodeType||d==a?[d]:""+d===d?/</.test(d)?((h=b.createElement(e||"div")).innerHTML=d,h.children):(e&&l(e)[0]||b).querySelectorAll(d):/f/.test(typeof d)?/c/.test(b.readyState)?d():l(b).on("DOMContentLoaded",d):d:c)},l.i[k="prototype"]=(l.extend=function(a){for(j=arguments,h=1;h<j.length;h++)if(k=j[h])for(i in k)a[i]=k[i];
return a})(l.fn=l[k]=c,{on:function(a,b){return a=a.split(d),this.map(function(c){(d[h=a[0]+(c.b$=c.b$||++e)]=d[h]||[]).push([b,a[1]]),c["add"+f](a[0],b)}),this},off:function(a,b){return a=a.split(d),k="remove"+f,this.map(function(c){if(j=d[a[0]+c.b$],h=j&&j.length)for(;i=j[--h];)b&&b!=i[0]||a[1]&&a[1]!=i[1]||(c[k](a[0],i[0]),j.splice(h,1));else!a[1]&&c[k](a[0],b)}),this},is:function(a){return h=this[0],i=!!h&&(h.matches||h["webkit"+g]||h["moz"+g]||h["ms"+g]),!!i&&i.call(h,a)}}),l}(window,document,[],/\.(.+)/,0,"EventListener","MatchesSelector"),d=function(){function DOMTokenList(a){this.el=a;for(var b=a.className.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c++)d.call(this,b[c])}function defineElementGetter(a,b,c){Object.defineProperty?Object.defineProperty(a,b,{get:c}):a.__defineGetter__(b,c)}var a=function(a,b){return"boolean"==typeof b?this[b?"add":"remove"](a):this[this.contains(a)?"remove":"add"](a),this.contains(a)};if(window.DOMTokenList){var b=document.createElement("a");
b.classList.toggle("x",!1),b.className&&(window.DOMTokenList.prototype.toggle=a)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var c=Array.prototype,d=c.push,e=c.splice,f=c.join;DOMTokenList.prototype={add:function(a){this.contains(a)||(d.call(this,a),this.el.className=this.toString())},contains:function(a){return-1!=this.el.className.indexOf(a)},item:function(a){return this[a]||null},remove:function(a){if(this.contains(a)){for(var b=0;b<this.length&&this[b]!=a;b++);e.call(this,b,1),this.el.className=this.toString()}},toString:function(){return f.call(this," ")},toggle:a},window.DOMTokenList=DOMTokenList,defineElementGetter(Element.prototype,"classList",function(){return new DOMTokenList(this)})}}(),e=function(a){var b,c,d="classList";if(!a)throw new Error("Balalaika is missing");return b=a.fn.on,c=a.fn.off,a.extend(a.fn,{on:function(a,c){return a.split(/\s/).forEach(function(a){b.call(this,a,c)},this),this},off:function(a,b){return a.split(/\s/).forEach(function(a){
c.call(this,a,b)},this),this},hasClass:function(a){return!!this[0]&&this[0][d].contains(a)},addClass:function(a){return this.forEach(function(b){var c=b[d];c.add.apply(c,a.split(/\s/))}),this},removeClass:function(a){return this.forEach(function(b){var c=b[d];c.remove.apply(c,a.split(/\s/))}),this},toggleClass:function(a,b){return this.forEach(function(c){var e=c[d];"boolean"!=typeof b&&(b=!e.contains(a)),e[b?"add":"remove"].apply(e,a.split(/\s/))}),this},add:function(b){var c,d,e=a(this),f=function(a,b){for(d=0;d<a.length;d++)if(a[d]===b)return d};for(b=a(b).slice(),[].push.apply(e,b),c=e.length-b.length;c<e.length;c++)([].indexOf?e.indexOf(e[c]):f(e,e[c]))!==c&&e.splice(c--,1);return e},not:function(b){var c,d,e=a(this);for(b=a(b),d=0;d<b.length;d++)~(c=e.indexOf(b[d]))&&e.splice(c,1);return e},find:function(b){var c=a();return this.forEach(function(d){c=c.add(a(b,d))}),c}}),a.parseHTML=function(b){var c,d,e=document.createElement("div"),f={option:[1,"<select multiple='multiple'>","</select>"],
legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_:[0,"",""]};for(b=b.replace(/^\s+|\s+$/g,""),f.optgroup=f.option,f.tbody=f.tfoot=f.colgroup=f.caption=f.thead,f.th=f.td,c=f[/<([\w:]+)/.exec(b)[1]]||f._,e.innerHTML=c[1]+b+c[2],d=c[0];d--;)e=e.children[0];return a(e.children)},a.create=function create(a,b){var c,d,e,f;if("object"==typeof a&&(b=a,a=b.tagName),c=document.createElement(a),b)for(d in b)if(f=b[d],"attributes"==d&&"object"==typeof f)for(e in f)f.hasOwnProperty(e)&&c.setAttribute(e,f[e]);else{if("tagName"==d)continue;if("children"==d&&f)for(e=0;e<f.length;e++)c.appendChild(create(f[e]));else if("object"==typeof c[d]&&null!==c[d]&&"object"==typeof b)for(e in f)f.hasOwnProperty(e)&&(c[d][e]=f[e]);else c[d]=f}return c},function(a,b,c,d,e,f){var g,h=a.createElement("div").children;
try{[].push.apply([],h)}catch(i){g=!0}return g=g||"function"==typeof h||a.documentMode<9,g&&(f=b.i[d="prototype"],b.i=function(g,h){for(e=g?g&&g.nodeType||g==window?[g]:"string"==typeof g?/</.test(g)?((c=a.createElement("div")).innerHTML=g,c.children):(h&&b(h)[0]||a).querySelectorAll(g):!/f/.test(typeof g)||g[0]||g[0].nodeType?g:/c/.test(a.readyState)?g():!function r(b){/in/(a.readyState)?setTimeout(r,9,b):b()}(g):f,d=[],c=e?e.length:0;c--;d[c]=e[c]);f.push.apply(this,d)},b.i[d]=f,f.is=function(a){var b,c=this[0],d=c.parentNode.querySelectorAll(a);for(b=0;b<d.length;b++)if(d[b]===c)return!0;return!1}),b}(document,a),a}(c),f=function(a){var b,c="on off is hasClass addClass removeClass toggleClass add not find".split(/\s+/),d="function"==typeof window.$?window.$:null,e=!0;if(d){for(b=0;b<c.length;b++)if(!d.prototype[c[b]]){e=!1;break}d.parseHTML||(e=!1)}else e=!1;return e?d:a}(e),g=function(a){var b,c=function(a,b,c){for(var d,e,f=a.length,g=0,h=0,i=[];f>h;h++)e=a[h],b?(d=new FileReader,d.onloadend=function(a){
e.readerResult=d.result,i[g++]=e,g==f&&c(i)},d["readAs"+b[0].toUpperCase()+b.slice(1)](e)):(i[g++]=e,g==f&&c(i))};return b={innerHTML:function(){return{on:null,getValue:function(){return this.innerHTML},setValue:function(a){this.innerHTML=null===a?"":a+""}}},className:function(a){var b,c=0===a.indexOf("!");return c&&(a=a.replace("!","")),{on:null,getValue:function(){return b=this.classList.contains(a),c?!b:!!b},setValue:function(b){this.classList.toggle(a,c?!b:!!b)}}},property:function(a){return{on:null,getValue:function(){return this[a]},setValue:function(b){try{this[a]=b}catch(c){}}}},attribute:function(a){return{on:null,getValue:function(){return this.getAttribute(a)},setValue:function(b){this.setAttribute(a,b)}}},dataset:function(a){return{on:null,getValue:function(){return this.dataset[a]},setValue:function(b){this.dataset[a]=b}}},textarea:function(){return b.input("text")},progress:function(){return b.input()},input:function(a,b){var c;switch(a){case"checkbox":return{on:"click keyup",
getValue:function(){return this.checked},setValue:function(a){this.checked=a}};case"radio":return{on:"click keyup",getValue:function(){return this.value},setValue:function(a){this.checked=this.value==a}};case"submit":case"button":case"image":case"reset":return{};case"hidden":c=null;break;case"file":c="change";break;case"text":case"password":c=8==document.documentMode?"keyup paste":"input";break;default:c="input"}return{on:c,getValue:function(){return this.value},setValue:function(a){this.value!=a&&(this.value=a)}}},select:function(a){var b;return a?{on:"change",getValue:function(){return[].slice.call(this.options).filter(function(a){return a.selected}).map(function(a){return a.value})},setValue:function(a){for(a="string"==typeof a?[a]:a,b=this.options.length-1;b>=0;b--)this.options[b].selected=~a.indexOf(this.options[b].value)}}:{on:"change",getValue:function(){return this.value},setValue:function(a){var c,d=this;if(d.value=a,!a)for(c=d.options,b=c.length-1;b>=0;b--)c[b].value||(c[b].selected=!0);
}}},visibility:function(a){return a="undefined"==typeof a?!0:a,{on:null,getValue:null,setValue:function(b){this.style.display=a?b?"":"none":b?"none":""}}},file:function(a){if("undefined"!=typeof FileList)return{on:function(b){var d=function(){var d=this.files;d.length?c(d,a,function(a){b(a)}):b([])};this.addEventListener("change",d)},getValue:function(a){var b=a.domEvent||[];return this.multiple?b:b[0]||null}};throw Error("file binder is not supported at this browser")},style:function(a){return{getValue:function(){return window.getComputedStyle?getComputedStyle(this,null).getPropertyValue(a):this.currentStyle[a]},setValue:function(b){this.style[a]=b}}}}}({}),h=function(a,b,c){var d,e,f,g,h,i,j=function(a){return a._initMK?a._initMK():d.initMK(a),a},k=function(a,c){var e,f,g,i,j,k,l,m,n=b();for(i=c.replace(/:sandbox/g,":bound(sandbox)").split(","),k=0;k<i.length;k++)if(j=i[k],e=/:bound\(([^(]*)\)(.*)/.exec(h(j)))if(f=a.$bound(e[1]),j=h(e[2]))if(0===j.indexOf(">"))for(l=0;l<f.length;l++)g=f[l],
m=d.randomString(),g.setAttribute(m,m),n=n.add(b("["+m+'="'+m+'"]'+j,g)),g.removeAttribute(m);else n=n.add(f.find(j));else n=n.add(f);else n=n.add(j);return n};return d={domEvents:{list:{},add:function(a){a.node&&("function"==typeof a.on?a.on.call(a.node,a.handler):b(a.node).on(a.on.split(/\s/).join(".mk ")+".mk",a.handler)),(this.list[a.instance[i].id]=this.list[a.instance[i].id]||[]).push(a)},remove:function(a){var c,e,f=this.list[a.instance[i].id];if(f)for(e=0;e<f.length;e++)c=f[e],c.node===a.node&&(c.mkHandler&&d._off(a.instance,"_runbindings:"+a.key,c.mkHandler),"string"==typeof c.on&&b(a.node).off(c.on+".mk",c.handler),c.removed=!0,this.list[a.instance[i].id].splice(e--,1))}},initMK:function(a){return a[i]||Object.defineProperty(a,i,{value:{events:{},special:{},id:"mk"+Math.random()},enumerable:!1,configurable:!1,writable:!1}),a},on:function(a,b,c,e,f,g){if(!a)return a;j(a);var i,k;if("object"==typeof b&&!(b instanceof Array)){for(k in b)b.hasOwnProperty(k)&&d.on(a,k,b[k],c,e);return a;
}if(!c)throw Error('callback is not function for event(s) "'+b+'"');for(b=b instanceof Array?b:h(b).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"boolean"!=typeof e&&"undefined"!=typeof e&&(i=f,f=e,e=i),k=0;k<b.length;k++)d._on(a,b[k],c,f,g);return e===!0&&c.call(f||a,{triggeredOnInit:!0}),a},_fastAddListener:function(a,b,c,e,f){var g=a[i].events,h=g[b]||(g[b]=[]);return h.push({callback:c,context:e,ctx:e||a,name:b}),0===b.indexOf("change:")&&d._defineSpecial(a,b.replace("change:","")),a},_addListener:function(a,b,c,e,f){if(!a||"object"!=typeof a)return a;j(a);var g,h,k,l,m=e||a,n=a[i].events,o=n[b]||(n[b]=[]),p=o.length,q=/([^\:\:]+)(::([^\(\)]+)?(\((.*)\))?)?/,r={callback:c,context:e,ctx:m,name:b};for(g=0;p>g;g++)if(h=o[g],(h.callback==c||h.callback==c._callback)&&h.context==e)return a;if(f){k={};for(g in f)k[g]=f[g];for(g in r)k[g]=r[g]}else k=r;return o.push(k),l=q.exec(b),l&&l[2]?d._addDOMListener(a,l[3]||"sandbox",l[1],l[5],c,m,k):0===b.indexOf("change:")&&d._defineSpecial(a,b.replace("change:","")),
n["addevent:"+b]&&d._trigger(a,"addevent:"+b),a},_removeListener:function(a,b,c,e,f){if(!a||"object"!=typeof a||!a[i]||!a[i].events)return a;var g,h,j,k=a[i].events[b]||[],l=a[i].events[b]=[],m=/([^\:\:]+)(::([^\(\)]+)(\((.*)\))?)?/,n=0,o=k.length;if(f=f||{},j=m.exec(b),j&&j[2])d._removeDOMListener(a,j[3],j[1],j[5],c,e);else{for(h=0;o>h;h++)g=k[h],(g.howToRemove?!g.howToRemove(g,f):c&&c!==g.callback&&c._callback!==g.callback||e&&e!==g.context)&&(l[n++]=g);l.length||delete a[i].events[b]}return a},_delegateListener:function(a,b,c,e,f,g){if(!a||"object"!=typeof a)return a;j(a);var h,k=/([^\.]+)\.(.*)/.exec(b),l=k?k[1]:b;if(b=k?k[2]:"",g=g||{},l)if("*"==l)if(a.isMKArray)h=function(h){(h&&h.added?h.added:a).forEach(function(a){a&&d._delegateListener(a,b,c,e,f,g)})},h._callback=e,d._addListener(a,"add",h,f,g),h();else{if(!a.isMKObject)throw Error('"*" events are only allowed for MK.Array and MK.Object');h=function(h){var j=a[h.key];j&&h&&h.key in a[i].keys&&d._delegateListener(j,b,c,e,f,g)},
a.each(function(a){d._delegateListener(a,b,c,e,f,g)}),h._callback=e,d._addListener(a,"change",h,f,g)}else h=function(h){if(!h||!h._silent){var j,k,m,n=a[l],o=!0;if(g.path=b,g.previousValue=h&&h.previousValue||g.previousValue&&g.previousValue[l],h&&h.previousValue&&h.previousValue[i]&&d._undelegateListener(h.previousValue,b,c,e,f,g),"object"==typeof n&&n&&d._delegateListener(n,b,c,e,f,g),0===c.indexOf("change:")&&(j=c.replace("change:",""),!b&&g.previousValue&&g.previousValue[j]!==n[j])){if(m=g.previousValue[i].events[c])for(k=0;k<m.length;k++)m[k].path===b&&(o=!1);o&&d.set(n,j,n[j],{force:!0,previousValue:g.previousValue[j],previousObject:g.previousValue,_silent:!0})}}},h._callback=e,d._addListener(a,"change:"+l,h,f,g),h();else d._addListener(a,c,e,f,g)},_delegateTreeListener:function(a,b,c,e,g,h){if(!a||"object"!=typeof a)return a;var i;return i=function(f){var i=a[f.key];i&&(d._delegateListener(i,b,c,e,g,h),d._delegateTreeListener(i,b,c,e,g,h))},f(a,function(a){d._delegateListener(a,b,c,e,g,h),
d._delegateTreeListener(a,b,c,e,g,h)}),i._callback=e,d._addListener(a,"change",i,g,h),a},_undelegateListener:function(a,b,c,e,f,g){if(!a||"object"!=typeof a)return a;var h,j,k=/([^\.]+)\.(.*)/.exec(b),l=k?k[1]:b,m=b;if(b=k?k[2]:"",l)if("*"==l){if(a.isMKArray){if(e)d._undelegateListener(a,b,"add",e,f,g);else for(h=a[i].events.add||[],j=0;j<h.length;j++)h[j].path==m&&d._undelegateListener(a,b,"add",h[j].callback);a.forEach(function(a){a&&d._undelegateListener(a,b,c,e,f)})}else if(a.isMKObject){if(e)d._undelegateListener(a,b,"change",e,f);else for(h=a[i].events.change||[],j=0;j<h.length;j++)h[j].path==m&&d._undelegateListener(a,b,"change",h[j].callback);a.each(function(a){a&&d._undelegateListener(a,b,c,e,f)})}}else{if(e)d._removeListener(a,"change:"+l,e,f,g);else for(h=a[i].events["change:"+l]||[],j=0;j<h.length;j++)h[j].path==m&&d._removeListener(a,"change:"+l,h[j].callback);"object"==typeof a[l]&&d._undelegateListener(a[l],b,c,e,f,g)}else d._removeListener(a,c,e,f,g)},_addDOMListener:function(a,c,e,f,g,h,k){
if(!a||"object"!=typeof a)return a;j(a),f=f||null,k=k||{};var l=function(d){var e,i,j=this,k=b(j),l={self:a,node:j,$nodes:k,key:c,domEvent:d,originalEvent:d.originalEvent||d,preventDefault:function(){d.preventDefault()},stopPropagation:function(){d.stopPropagation()},which:d.which,target:d.target};f?(e="x"+String(Math.random()).split(".")[1],j.setAttribute(e,e),i="["+e+'="'+e+'"] '+f,b(d.target).is(i+","+i+" *")&&g.call(h,l),j.removeAttribute(e)):g.call(h,l)},m=e+"."+a[i].id+c,n=function(a){a&&a.$nodes&&a.$nodes.on(m,l)},o=function(a){a&&a.$nodes&&a.$nodes.off(m,l)};return d._defineSpecial(a,c),n._callback=o._callback=g,d._addListener(a,"bind:"+c,n,h,k),d._addListener(a,"unbind:"+c,o,h,k),n({$nodes:a[i].special[c]&&a[i].special[c].$nodes}),a},_removeDOMListener:function(a,b,c,e,f,g,h){return a&&"object"==typeof a&&a[i]&&a[i].events?(e=e||null,h=h||{},b&&a[i].special[b]&&(a[i].special[b].$nodes.off(c+"."+a[i].id+b),d._removeListener(a,"bind:"+b,f,g,h),d._removeListener(a,"unbind:"+b,f,g,h)),
a):a},_on:function(a,b,c,e){if(!a)return a;j(a);var f,g=b.lastIndexOf("@");return~g?(f=b.slice(0,g).replace(/([^@]*)@/g,function(a,b){return(b||"*")+"."}).replace(/\.$/,".*")||"*",b=b.slice(g+1),d._delegateListener(a,f,b,c,e||a)):d._addListener(a,b,c,e),a},_off:function(a,b,c,e){if(!a)return a;j(a);var f,g=b.lastIndexOf("@");return~g?(f=b.slice(0,g),b=b.slice(g+1).replace(/@/g,"."),d._undelegateListener(a,f,b,c,e)):d._removeListener(a,b,c,e),a},once:function(a,b,c,e,f){var g;if(!a||"object"!=typeof a)return a;if("object"==typeof b){for(g in b)b.hasOwnProperty(g)&&d.once(a,g,b[g],c,e);return a}if(!c)throw Error('callback is not function for event "'+b+'"');for(j(a),b=b.split(/\s/),g=0;g<b.length;g++)!function(b){var f=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}(c);f._callback=c,d._on(a,b,f,e)}(b[g]);return a},onDebounce:function(a,b,c,e,f,g,h){if(!a||"object"!=typeof a)return a;var i,j;if("object"==typeof b){for(j in b)b.hasOwnProperty(j)&&d.onDebounce(a,j,b[j],c,e,f,g);
return a}return"number"!=typeof e&&(h=g,g=f,f=e,e=0),i=d.debounce(c,e),i._callback=c,d.on(a,b,i,f,g,h)},_defineSpecial:function(a,c,e){if(!a||"object"!=typeof a||!a[i])return a;var f=a[i].special[c];return f||(f=a[i].special[c]={$nodes:b(),value:a[c],getter:null,setter:null,mediator:null},e||Object.defineProperty(a,c,{configurable:!0,enumerable:!0,get:function(){return f.getter?f.getter.call(a):f.value},set:function(b){f.setter?f.setter.call(a,b):d.set(a,c,b,{fromSetter:!0})}})),f},mediate:function(a,b,c){if(!a||"object"!=typeof a)return a;j(a);var e,f,g=typeof b;if("object"==g&&!(b instanceof Array)){for(e in b)b.hasOwnProperty(e)&&d.mediate(a,e,b[e]);return a}for(b="string"==g?b.split(/\s/):b,e=0;e<b.length;e++)(function(b){f=d._defineSpecial(a,b),f.mediator=function(d){return c.call(a,d,f.value,b,a)},d.set(a,b,f.mediator(f.value),{fromMediator:!0})})(b[e]);return a},setClassFor:function(a,b,c,e){if(!a||"object"!=typeof a)return a;j(a);var f,g=typeof b;if("object"==g&&!(b instanceof Array)){
for(f in b)b.hasOwnProperty(f)&&d.setClassFor(a,f,b[f],c);return a}for(b="string"==g?b.split(/\s/):b,e=e||function(a,b){var c;if(a.isMKArray)a.recreate(b);else if(a.isMKObject)a.jset(b);else for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},f=0;f<b.length;f++)d.mediate(a,b[f],function(b,d){var f;return d instanceof c?(e.call(a,d,b),f=d):f=new c(b),f});return a},linkProps:function(a,b,c,e,f,g){if(!a||"object"!=typeof a)return a;j(a),c="string"==typeof c?c.split(/\s/):c,g=g||{};var h,k,l,m,n,o=function(f){var j=[],o=f._protect=f._protect||{};if(f.fromDependency=!0,!(b+a[i].id in o)){if("object"==typeof c[0])for(m=0;m<c.length;m+=2)for(h=c[m],l="string"==typeof c[m+1]?c[m+1].split(/\s/):c[m+1],n=0;n<l.length;n++)j.push(h[l[n]]);else for(m=0;m<c.length;m++)k=c[m],h=a,j.push(h[k]);o[b+a[i].id]=1,d._defineSpecial(a,b,g.hideProperty),d.set(a,b,e.apply(a,j),f)}};if(e=e||function(a){return a},"object"==typeof c[0])for(m=0;m<c.length;m+=2)for(h=j(c[m]),l="string"==typeof c[m+1]?c[m+1].split(/\s/):c[m+1],
n=0;n<l.length;n++)d._defineSpecial(h,l[n]),d._fastAddListener(h,"_rundependencies:"+l[n],o);else for(m=0;m<c.length;m++)k=c[m],h=a,d._defineSpecial(h,k),d._fastAddListener(h,"_rundependencies:"+k,o);return f!==!1&&o.call("object"==typeof c[0]?c[0]:a,{key:"object"==typeof c[0]?c[1]:c[0]}),a},off:function(a,b,c,e){var f;if("object"==typeof b&&!(b instanceof Array)){for(f in b)b.hasOwnProperty(f)&&d.off(a,f,b[f],c);return a}if(!b&&!c&&!e&&a[i])return a[i].events={},a;if(b=h(b).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"object"!=typeof a)return a;for(f=0;f<b.length;f++)a._off?a._off(b[f],c,e):d._off(a,b[f],c,e);return a},trigger:function(a,b){if(!a||"object"!=typeof a||!a[i]||!a[i].events)return a;var c,f;if(b)for(c=e(arguments),b=b.split(/\s/),f=0;f<b.length;f++)c=c.slice(),d._trigger.apply(d,c);return a},_trigger:function(a,b){var c,d,f,g,h=a&&"object"==typeof a&&a[i]&&a[i].events&&a[i].events[b];if(h)for(c=e(arguments,2),d=-1,f=h.length;++d<f;)(g=h[d]).callback.apply(g.ctx,c);return a;
},_fastTrigger:function(a,b,c){var d,e,f,g=a[i].events[b];if(g)for(d=-1,e=g.length;++d<e;)(f=g[d]).callback.call(f.ctx,c)},bindNode:function(a,b,c,e,f,g){if(!a||"object"!=typeof a)return a;j(a);var k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(b instanceof Array){for(n=0;n<b.length;n++)d.bindNode(a,b[n][0],b[n][1],b[n][2]||f,c);return a}if("string"==typeof b&&(m=h(b).split(/\s+/),m.length>1)){for(n=0;n<m.length;n++)d.bindNode(a,m[n],c,e,f,g);return a}if("object"==typeof b){for(n in b)b.hasOwnProperty(n)&&d.bindNode(a,n,b[n],c,e,f);return a}if(c&&2==c.length&&!c[1].nodeName&&(c[1].setValue||c[1].getValue||c[1].on))return d.bindNode(a,b,c[0],c[1],e,f);if(q=b.indexOf("."),~q)return r=b.split("."),s=function(b){var f=b&&b.value;if(!f){f=a;for(var h=0;h<r.length-1;h++)f=f[r[h]]}d.bindNode(f,r[r.length-1],c,e,b,g),b&&b.previousValue&&d.unbindNode(b.previousValue,r[r.length-1],c)},d._delegateListener(a,r.slice(0,r.length-2).join("."),"change:"+r[r.length-2],s),s(),a;if(l=d._getNodes(a,c),!l.length){if(g)return a;
throw Error('Binding error: node is missing for key "'+b+'".'+("string"==typeof c?' The selector is "'+c+'"':""))}if(f=f||{},p=d._defineSpecial(a,b,"sandbox"==b),k="undefined"==typeof p.value,p.$nodes=p.$nodes.length?p.$nodes.add(l):l,a.isMK&&("sandbox"==b&&(a.$sandbox=l,a.sandbox=l[0]),a.$nodes[b]=p.$nodes,a.nodes[b]=p.$nodes[0]),"sandbox"!=b)for(n=0;n<l.length;n++)(function(c){var g,h={self:a,key:b,$nodes:l,node:c};if(null===e)g={};else if(w="sandbox"==b?null:d.lookForBinder(c)){if(e)for(o in e)w[o]=e[o];g=w}else g=e||{};if(g.initialize){u={value:p.value};for(o in h)u[o]=h[o];g.initialize.call(c,u)}if(g.setValue&&(v=function(d){var e=a[i].special[b].value;if(!d||d.changedNode!=c||d.onChangeValue!=e){u={value:e};for(o in h)u[o]=h[o];g.setValue.call(c,e,u)}},d._fastAddListener(a,"_runbindings:"+b,v),!k&&v()),g.getValue&&(k&&f.assignDefaultValue!==!1||f.assignDefaultValue===!0)){x={fromNode:!0};for(o in f)x[o]=f[o];d.set(a,b,g.getValue.call(c,h),x)}g.getValue&&g.on&&(t={node:c,on:g.on,instance:a,
key:b,mkHandler:v,handler:function(e){if(!t.removed){var f,i,j=a[b],k={value:j,domEvent:e,originalEvent:e.originalEvent||e,preventDefault:function(){e.preventDefault()},stopPropagation:function(){e.stopPropagation()},which:e.which,target:e.target};for(i in h)k[i]=h[i];f=g.getValue.call(c,k),f!==j&&d.set(a,b,f,{fromNode:!0,changedNode:c,onChangeValue:f})}}},d.domEvents.add(t))})(l[n]);if(!f.silent){x={key:b,$nodes:l,node:l[0]||null};for(n in f)x[n]=f[n];d._fastTrigger(a,"bind:"+b,x),d._fastTrigger(a,"bind",x)}return a},bindOptionalNode:function(a,b,c,e,f){return"object"==typeof b?d.bindNode(a,b,c,e,!0):d.bindNode(a,b,c,e,f,!0),a},unbindNode:function(a,b,c,e){if(!a||"object"!=typeof a)return a;j(a);var g,h,k,l,m,n,o=typeof b,p=a[i].special[b];if(b instanceof Array){for(k=0;k<b.length;k++)e=c,d.unbindNode(a,b[k][0],b[k][1]||e,e);return a}if("string"==o&&(h=b.split(/\s/),h.length>1)){for(k=0;k<h.length;k++)d.unbindNode(a,h[k],c,e);return a}if(l=b.indexOf("."),~l){m=b.split(".");var q=a;for(k=0;k<m.length-1;k++)q=q[m[k]];
return d._undelegateListener(a,m.slice(0,m.length-2),"change:"+m[m.length-2]),d.unbindNode(q,m[m.length-1],c,e),a}if(null===b){for(b in a[i].special)a[i].special.hasOwnProperty(b)&&d.unbindNode(a,b,c,e);return a}if("object"==o){for(k in b)b.hasOwnProperty(k)&&d.unbindNode(a,k,b[k],c);return a}if(!c)return p&&p.$nodes?d.unbindNode(a,b,p.$nodes,e):a;if(2==c.length&&!c[1].nodeName&&(c[1].setValue||c[1].getValue||c[1].on))return d.unbindNode(a,b,c[0],e);if(!p)return a;if(g=d._getNodes(a,c),f(g,function(c,e){d.domEvents.remove({key:b,node:c,instance:a}),p.$nodes=p.$nodes.not(c)}),a.isMK&&(a.$nodes[b]=p.$nodes,a.nodes[b]=p.$nodes[0]||null,"sandbox"==b&&(a.sandbox=p.$nodes[0]||null,a.$sandbox=p.$nodes)),!e||!e.silent){n={key:b,$nodes:g,node:g[0]||null};for(k in e)n[k]=e[k];d._fastTrigger(a,"unbind:"+b,n),d._fastTrigger(a,"unbind",n)}return a},selectAll:function(a,c){return a&&"object"==typeof a&&a.$sandbox?(j(a),/:sandbox|:bound\(([^(]*)\)/.test(c)?k(a,c):a.$sandbox.find(c)):b()},select:function(a,b){
return d.selectAll(a,b)[0]||null},boundAll:function(a,c){if(!a||"object"!=typeof a)return b();j(a);var d,e,f,g=a[i].special;if(c=c?c:"sandbox",d="string"==typeof c?c.split(/\s+/):c,d.length<=1)return d[0]in g?g[d[0]].$nodes:b();for(e=b(),f=0;f<d.length;f++)e=e.add(g[d[f]].$nodes);return e},$bound:function(a,b){return d.boundAll(a,b)},bound:function(a,b){if(!a||"object"!=typeof a)return null;j(a);var c,d,e=a[i].special;if(b=b?b:"sandbox",c="string"==typeof b?b.split(/\s+/):b,c.length<=1)return c[0]in e?e[c[0]].$nodes[0]||null:null;for(d=0;d<c.length;d++)if(c[d]in e&&e[c[d]].$nodes.length)return e[c[d]].$nodes[0];return null},get:function(a,b){return a&&a[b]},set:function(a,b,c,e){if(!a||"object"!=typeof a)return a;var f,g,h,j,k,l,m,n=typeof b,o=Number.isNaN||function(a){return"number"==typeof a&&isNaN(a)};if("undefined"==n)return a;if("object"==n){for(k in b)b.hasOwnProperty(k)&&d.set(a,k,b[k],c);return a}if(!a[i]||!a[i].special||!a[i].special[b])return a[b]=c,a;if(f=a[i].special[b],g=a[i].events,
h=f.value,j=!f.mediator||c===h||e&&(e.skipMediator||e.fromMediator)?c:f.mediator(c,h,b,a),l={value:j,previousValue:h,key:b,node:f.$nodes[0]||null,$nodes:f.$nodes,self:a},e&&"object"==typeof e)for(k in e)l[k]=e[k];return m=(j!==h||l.force)&&!l.silent,m&&(g["beforechange:"+b]&&d._fastTrigger(a,"beforechange:"+b,l),g.beforechange&&d._fastTrigger(a,"beforechange",l)),f.value=j,(j!==h||l.force||l.forceHTML||j!==c&&!o(j))&&(l.silentHTML||g["_runbindings:"+b]&&d._fastTrigger(a,"_runbindings:"+b,l)),m&&(g["change:"+b]&&d._fastTrigger(a,"change:"+b,l),g.change&&d._fastTrigger(a,"change",l)),j===h&&!l.force&&!l.forceHTML||l.skipLinks||g["_rundependencies:"+b]&&d._fastTrigger(a,"_rundependencies:"+b,l),a},parseBindings:function(a,c){if(!a||"object"!=typeof a)return b();if("string"==typeof c){if(!~c.indexOf("{{"))return d.$.parseHTML(c.replace(/^\s+|\s+$/g,""));c=d.$.parseHTML(c.replace(/^\s+|\s+$/g,""))}else c=c?b(c):d.boundAll(["sandbox"]);j(a);var e,f,g,h,k,l,m,n,o,p,q=function(a){var b,c,d,e,f;if("TEXTAREA"!=a.tagName)for(b=0;b<a.childNodes.length;b++)if(e=a.childNodes[b],
c=e.previousSibling,3==e.nodeType&&~e.nodeValue.indexOf("{{")){d=e.nodeValue.replace(/{{([^}]*)}}/g,'<mk-bind mk-html="$1"></mk-bind>');try{c?c.insertAdjacentHTML("afterend",d):a.insertAdjacentHTML("afterbegin",d)}catch(g){f=document.body,c?(f.appendChild(c),c.insertAdjacentHTML("afterend",d),f.removeChild(c)):(f.appendChild(a),a.insertAdjacentHTML("afterbegin",d),f.removeChild(a))}a.removeChild(e)}else 1==e.nodeType&&q(e)};for(e=0;e<c.length;e++)q(c[e]);for(g=c.find("*").add(c),e=0;e<g.length;e++)for(h=g[e],k=h.getAttribute("mk-html"),k&&d.bindNode(a,k,h,{setValue:function(a){this.innerHTML=a}}),f=0;f<h.attributes.length;f++)l=h.attributes[f],m=l.value,n=l.name,~m.indexOf("{{")&&(o=m.match(/{{[^}]*}}/g).map(function(a){return a.replace(/{{(.*)}}/,"$1")}),1==o.length&&/^{{[^}]*}}$/g.test(m)?p=o[0]:(p=d.randomString(),d.linkProps(a,p,o,function(){var b=m;return o.forEach(function(c){b=b.replace(new RegExp("{{"+c+"}}","g"),a[i].special[c].value)}),b},!0,{hideProperty:!0})),("value"==n&&"checkbox"!=h.type||"checked"==n&&"checkbox"==h.type)&&d.lookForBinder(h)?d.bindNode(a,p,h):d.bindNode(a,p,h,{
setValue:function(a){this.setAttribute(n,a)}}));return c},remove:function(a,b,c){if(!a||"object"!=typeof a)return null;var e,f,g=String(b).split(/\s/),h={keys:g};if(c&&"object"==typeof c)for(f in c)h[f]=c[f];for(f=0;f<g.length;f++)if(b=g[f],e=b in a){h.key=b,h.value=a[b];try{delete a[b]}catch(j){}a[i]&&(d.unbindNode(a,b),d.off(a,"change:"+b+" beforechange:"+b+" _runbindings:"+b+" _rundependencies:"+b),delete a[i].special[b],h.silent||(d._fastTrigger(a,"delete",h),d._fastTrigger(a,"delete:"+b,h)))}return a},_getNodes:function(a,c){return"string"==typeof c&&!/</.test(c)&&/:sandbox|:bound\(([^(]*)\)/.test(c)?k(a,c):b(c)},define:function(a,b,c){if(!a||"object"!=typeof a)return a;var e;if("object"==typeof b){for(e in b)d.define(a,e,b[e]);return a}return Object.defineProperty(a,b,c),a},defineGetter:function(a,b,c){if(!a||"object"!=typeof a)return a;j(a);var e,f;if("object"==typeof b){for(e in b)b.hasOwnProperty(e)&&d.defineGetter(a,e,b[e]);return a}return f=d._defineSpecial(a,b),f.getter=function(){
return c.call(a,{value:f.value,key:b,self:a})},a},defineSetter:function(a,b,c){if(!a||"object"!=typeof a)return a;j(a);var e;if("object"==typeof b){for(e in b)b.hasOwnProperty(e)&&d.defineSetter(a,e,b[e]);return a}return d._defineSpecial(a,b).setter=function(d){return c.call(a,d,{value:d,key:b,self:a})},a},delay:function(a,b,c,d){return"object"==typeof c&&(d=c,c=0),setTimeout(function(){b.call(d||a)},c||0),a},trim:h=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},toArray:e=function(a,b){var c,d=[],e=a.length;for(b=b||0,c=b;e>c;c++)d[c-b]=a[c];return d},extend:g=function(a,b){var c,d;if(a)for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a},each:f=function(a,b,c){if(a){if(a.isMK&&"function"==typeof a.each)a.each(b,c);else if("length"in a)[].forEach.call(a,b,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}},randomString:function(){return((new Date).getTime()-new Date(2013,4,3).getTime()).toString(36)+Math.floor(1679616*Math.random()).toString(36);
},binders:c,defaultBinders:[function(a){var b,d=a.tagName;return"INPUT"==d?b=c.input(a.type):"TEXTAREA"==d?b=c.textarea():"SELECT"==d?b=c.select(a.multiple):"PROGRESS"==d&&(b=c.progress()),b}],lookForBinder:function(a){var b,c,e=d.defaultBinders;for(c=0;c<e.length;c++)if(b=e[c].call(a,a))return b},debounce:function(a,b,c){var d;return"number"!=typeof b&&(c=b,b=0),function(){var e=arguments,f=this;clearTimeout(d),d=setTimeout(function(){a.apply(c||f,e)},b||0)}},noop:function(){},$:b,$b:a,useAs$:function(a){return d.$=this.$=b=a}},i=d.sym="undefined"==typeof Symbol?"mk-"+d.randomString():Symbol("matreshka"),d}(e,f,g),h.version="1.1.0-alpha.1",function(){"undefined"!=typeof a&&("function"==typeof define&&define.amd?(define("matreshka-magic",function(){return h}),define(function(){return h})):"object"==typeof exports?a.module.exports=h:a.magic=a.MatreshkaMagic=h)}()}(this);
//# sourceMappingURL=matreshka-magic.min.map