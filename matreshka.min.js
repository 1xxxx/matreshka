/*
	Matreshka v1.1.0-alpha.1 (2015-09-14)
	JavaScript Framework by Andrey Gubanov
	Released under the MIT license
	More info: http://matreshka.io
*/

!function(a){var b,c,d,e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;b=function(){var a=function(a){return!!a&&("[object Arguments]"===a.toString()||"object"==typeof a&&null!==a&&"length"in a&&"callee"in a)},b=function(){var a,b,c=-1;return"Microsoft Internet Explorer"==navigator.appName&&(a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==b.exec(a)&&(c=parseFloat(RegExp.$1))),c}(),c=document.documentMode,d=8===c,e="Internet Explorer "+b+" doesn't support Class function";if(~b&&8>b)throw Error(e);if(8>c)throw Error(e+'. Switch your "Document Mode" to "Standards"');var f=function(b){var c,e=b.constructor!==Object?b.constructor:function EmptyConstructor(){},g=b["extends"]=b["extends"]||b.extend,h=g&&g.prototype,i=b["implements"]=b["implements"]||b.implement,j={};if(c=e,delete b.extend,delete b.implement,h){for(var k in h)j[k]="function"==typeof h[k]?function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d);
}}(h[k]):h[k];j.constructor=function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d)}}(h.constructor)}return d?(b.prototype=null,b.constructor=null,e=function(){if(this instanceof e){var a=new XDomainRequest;for(var b in e.prototype)"constructor"!==b&&(a[b]=e.prototype[b]);return a.hasOwnProperty=e.prototype.hasOwnProperty,c.apply(a,arguments),a}c.apply(this,arguments)},b.constructor=e,e.prototype=e.fn=b,e.parent=j,g&&f.IEInherits(e,g)):(b.constructor=e,e.prototype=e.fn=b,e.parent=j,g&&f.inherits(e,g)),i&&i.validate(e.prototype),e.same=function(){return function(){return e.apply(this,arguments)}},this instanceof f?new e:e};return f.inherits=function(a,b){var c,d=a.prototype,e=function(){};e.prototype=b.prototype,a.prototype=new e,a.prototype.constructor=a;for(c in d)a.prototype[c]=d[c];"undefined"!=typeof Symbol&&d[Symbol.iterator]&&(a.prototype[Symbol.iterator]=d[Symbol.iterator]),a.prototype.instanceOf=function(a){return this instanceof a}},
f.IEInherits=function(a,b){for(var c,d=a.prototype.hasOwnProperty,e=a.prototype.constructor,f=Object.prototype.hasOwnProperty;b;)c=c||b.prototype.hasOwnProperty,a.prototype=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}(b.prototype,a.prototype),b=b.prototype&&b.prototype["extends"]&&b.prototype["extends"].prototype;d!==f?a.prototype.hasOwnProperty=d:c!==f&&(a.prototype.hasOwnProperty=c),a.prototype.constructor=e,a.prototype.instanceOf=function(b){for(var c=a;c;){if(c===b)return!0;c=c.prototype["extends"]}return!1}},f.Interface=function Interface(a,b){var c,d,e={},f=function(a){return"object"==typeof a&&null!==a&&"length"in a};if(a instanceof Interface){for(d in a.propsMap)e[d]=1;c=f(b)?b:[].slice.call(arguments,1)}else c=f(a)?a:arguments;for(d=0;d<c.length;d++)e[c[d]]=1;this.propsMap=e,this.validate=function(a){for(d in this.propsMap)if("function"!=typeof a[d])throw Error('Interface error: Method "'+d+'" is not implemented in '+(a.constructor.name||a.name||"given")+" prototype");
}},f.isXDR=d,f}(),c={},d=function(){!function(a,b,c,d){b[c]||(Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){b=b||a.event,b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(window,document,"addEventListener","removeEventListener")}(),e=function(a,b,c,d,e,f,g,h,i,j,k,l){return l=function(a,b){return new l.i(a,b)},l.i=function(d,e){c.push.apply(this,d?d.nodeType||d==a?[d]:""+d===d?/</.test(d)?((h=b.createElement(e||"div")).innerHTML=d,h.children):(e&&l(e)[0]||b).querySelectorAll(d):/f/.test(typeof d)?/c/.test(b.readyState)?d():l(b).on("DOMContentLoaded",d):d:c)},l.i[k="prototype"]=(l.extend=function(a){for(j=arguments,h=1;h<j.length;h++)if(k=j[h])for(i in k)a[i]=k[i];return a;
})(l.fn=l[k]=c,{on:function(a,b){return a=a.split(d),this.map(function(c){(d[h=a[0]+(c.b$=c.b$||++e)]=d[h]||[]).push([b,a[1]]),c["add"+f](a[0],b)}),this},off:function(a,b){return a=a.split(d),k="remove"+f,this.map(function(c){if(j=d[a[0]+c.b$],h=j&&j.length)for(;i=j[--h];)b&&b!=i[0]||a[1]&&a[1]!=i[1]||(c[k](a[0],i[0]),j.splice(h,1));else!a[1]&&c[k](a[0],b)}),this},is:function(a){return h=this[0],i=!!h&&(h.matches||h["webkit"+g]||h["moz"+g]||h["ms"+g]),!!i&&i.call(h,a)}}),l}(window,document,[],/\.(.+)/,0,"EventListener","MatchesSelector"),f=function(){function DOMTokenList(a){this.el=a;for(var b=a.className.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c++)d.call(this,b[c])}function defineElementGetter(a,b,c){Object.defineProperty?Object.defineProperty(a,b,{get:c}):a.__defineGetter__(b,c)}var a=function(a,b){return"boolean"==typeof b?this[b?"add":"remove"](a):this[this.contains(a)?"remove":"add"](a),this.contains(a)};if(window.DOMTokenList){var b=document.createElement("a");b.classList.toggle("x",!1),
b.className&&(window.DOMTokenList.prototype.toggle=a)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var c=Array.prototype,d=c.push,e=c.splice,f=c.join;DOMTokenList.prototype={add:function(a){this.contains(a)||(d.call(this,a),this.el.className=this.toString())},contains:function(a){return-1!=this.el.className.indexOf(a)},item:function(a){return this[a]||null},remove:function(a){if(this.contains(a)){for(var b=0;b<this.length&&this[b]!=a;b++);e.call(this,b,1),this.el.className=this.toString()}},toString:function(){return f.call(this," ")},toggle:a},window.DOMTokenList=DOMTokenList,defineElementGetter(Element.prototype,"classList",function(){return new DOMTokenList(this)})}}(),g=function(a){var b,c,d="classList";if(!a)throw new Error("Balalaika is missing");return b=a.fn.on,c=a.fn.off,a.extend(a.fn,{on:function(a,c){return a.split(/\s/).forEach(function(a){b.call(this,a,c)},this),this},off:function(a,b){return a.split(/\s/).forEach(function(a){c.call(this,a,b);
},this),this},hasClass:function(a){return!!this[0]&&this[0][d].contains(a)},addClass:function(a){return this.forEach(function(b){var c=b[d];c.add.apply(c,a.split(/\s/))}),this},removeClass:function(a){return this.forEach(function(b){var c=b[d];c.remove.apply(c,a.split(/\s/))}),this},toggleClass:function(a,b){return this.forEach(function(c){var e=c[d];"boolean"!=typeof b&&(b=!e.contains(a)),e[b?"add":"remove"].apply(e,a.split(/\s/))}),this},add:function(b){var c,d,e=a(this),f=function(a,b){for(d=0;d<a.length;d++)if(a[d]===b)return d};for(b=a(b).slice(),[].push.apply(e,b),c=e.length-b.length;c<e.length;c++)([].indexOf?e.indexOf(e[c]):f(e,e[c]))!==c&&e.splice(c--,1);return e},not:function(b){var c,d,e=a(this);for(b=a(b),d=0;d<b.length;d++)~(c=e.indexOf(b[d]))&&e.splice(c,1);return e},find:function(b){var c=a();return this.forEach(function(d){c=c.add(a(b,d))}),c}}),a.parseHTML=function(b){var c,d,e=document.createElement("div"),f={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],
thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_:[0,"",""]};for(b=b.replace(/^\s+|\s+$/g,""),f.optgroup=f.option,f.tbody=f.tfoot=f.colgroup=f.caption=f.thead,f.th=f.td,c=f[/<([\w:]+)/.exec(b)[1]]||f._,e.innerHTML=c[1]+b+c[2],d=c[0];d--;)e=e.children[0];return a(e.children)},a.create=function create(a,b){var c,d,e,f;if("object"==typeof a&&(b=a,a=b.tagName),c=document.createElement(a),b)for(d in b)if(f=b[d],"attributes"==d&&"object"==typeof f)for(e in f)f.hasOwnProperty(e)&&c.setAttribute(e,f[e]);else{if("tagName"==d)continue;if("children"==d&&f)for(e=0;e<f.length;e++)c.appendChild(create(f[e]));else if("object"==typeof c[d]&&null!==c[d]&&"object"==typeof b)for(e in f)f.hasOwnProperty(e)&&(c[d][e]=f[e]);else c[d]=f}return c},function(a,b,c,d,e,f){var g,h=a.createElement("div").children;try{[].push.apply([],h)}catch(i){g=!0;
}return g=g||"function"==typeof h||a.documentMode<9,g&&(f=b.i[d="prototype"],b.i=function(g,h){for(e=g?g&&g.nodeType||g==window?[g]:"string"==typeof g?/</.test(g)?((c=a.createElement("div")).innerHTML=g,c.children):(h&&b(h)[0]||a).querySelectorAll(g):!/f/.test(typeof g)||g[0]||g[0].nodeType?g:/c/.test(a.readyState)?g():!function r(b){/in/(a.readyState)?setTimeout(r,9,b):b()}(g):f,d=[],c=e?e.length:0;c--;d[c]=e[c]);f.push.apply(this,d)},b.i[d]=f,f.is=function(a){var b,c=this[0],d=c.parentNode.querySelectorAll(a);for(b=0;b<d.length;b++)if(d[b]===c)return!0;return!1}),b}(document,a),a}(e),h=function(a){var b,c="on off is hasClass addClass removeClass toggleClass add not find".split(/\s+/),d="function"==typeof window.$?window.$:null,e=!0;if(d){for(b=0;b<c.length;b++)if(!d.prototype[c[b]]){e=!1;break}d.parseHTML||(e=!1)}else e=!1;return e?d:a}(g),i=function(a){var b=function(a,b){var c,d;if(a)for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a;
},c={extend:b,trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},randomString:function(){return((new Date).getTime()-new Date(2013,4,3).getTime()).toString(36)+Math.floor(1679616*Math.random()).toString(36)},toArray:function(a,b){var c,d=[],e=a.length;for(b=b||0,c=b;e>c;c++)d[c-b]=a[c];return d},debounce:function(a,b,c){var d;return"number"!=typeof b&&(c=b,b=0),function(){var e=arguments,f=this;clearTimeout(d),d=setTimeout(function(){a.apply(c||f,e)},b||0)}},each:function(a,b,c){if(a){if(a.isMK&&"function"==typeof a.each)a.each(b,c);else if("length"in a)[].forEach.call(a,b,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}},delay:function(a,b,c,d){return"object"==typeof c&&(d=c,c=0),setTimeout(function(){b.call(d||a)},c||0),a},noop:function(){}};return b(a,c),c}(c),j=function(a){return"undefined"==typeof Symbol?"mk-"+a.randomString():Symbol("matreshka")}(i),k=function(a){var b,c=function(a,b,c){for(var d,e,f=a.length,g=0,h=0,i=[];f>h;h++)e=a[h],b?(d=new FileReader,
d.onloadend=function(a){e.readerResult=d.result,i[g++]=e,g==f&&c(i)},d["readAs"+b[0].toUpperCase()+b.slice(1)](e)):(i[g++]=e,g==f&&c(i))};return a.binders=b={innerHTML:function(){return{on:null,getValue:function(){return this.innerHTML},setValue:function(a){this.innerHTML=null===a?"":a+""}}},className:function(a){var b,c=0===a.indexOf("!");return c&&(a=a.replace("!","")),{on:null,getValue:function(){return b=this.classList.contains(a),c?!b:!!b},setValue:function(b){this.classList.toggle(a,c?!b:!!b)}}},property:function(a){return{on:null,getValue:function(){return this[a]},setValue:function(b){try{this[a]=b}catch(c){}}}},attribute:function(a){return{on:null,getValue:function(){return this.getAttribute(a)},setValue:function(b){this.setAttribute(a,b)}}},dataset:function(a){return{on:null,getValue:function(){return this.dataset[a]},setValue:function(b){this.dataset[a]=b}}},textarea:function(){return b.input("text")},progress:function(){return b.input()},input:function(a,b){var c;switch(a){case"checkbox":
return{on:"click keyup",getValue:function(){return this.checked},setValue:function(a){this.checked=a}};case"radio":return{on:"click keyup",getValue:function(){return this.value},setValue:function(a){this.checked=this.value==a}};case"submit":case"button":case"image":case"reset":return{};case"hidden":c=null;break;case"file":c="change";break;case"text":case"password":c=8==document.documentMode?"keyup paste":"input";break;default:c="input"}return{on:c,getValue:function(){return this.value},setValue:function(a){this.value!=a&&(this.value=a)}}},select:function(a){var b;return a?{on:"change",getValue:function(){return[].slice.call(this.options).filter(function(a){return a.selected}).map(function(a){return a.value})},setValue:function(a){for(a="string"==typeof a?[a]:a,b=this.options.length-1;b>=0;b--)this.options[b].selected=~a.indexOf(this.options[b].value)}}:{on:"change",getValue:function(){return this.value},setValue:function(a){var c,d=this;if(d.value=a,!a)for(c=d.options,b=c.length-1;b>=0;b--)c[b].value||(c[b].selected=!0);
}}},visibility:function(a){return a="undefined"==typeof a?!0:a,{on:null,getValue:null,setValue:function(b){this.style.display=a?b?"":"none":b?"none":""}}},file:function(a){if("undefined"!=typeof FileList)return{on:function(b){var d=function(){var d=this.files;d.length?c(d,a,function(a){b(a)}):b([])};this.addEventListener("change",d)},getValue:function(a){var b=a.domEvent||[];return this.multiple?b:b[0]||null}};throw Error("file binder is not supported at this browser")},style:function(a){return{getValue:function(){return window.getComputedStyle?getComputedStyle(this,null).getPropertyValue(a):this.currentStyle[a]},setValue:function(b){this.style[a]=b}}}}}(c),m=function(a){return function(b){return b._initMK?b._initMK():a.initMK(b),b}}(c),n=function(a,b){a._defineSpecial=function(c,d,e){if(!c||"object"!=typeof c||!c[b])return c;var f=c[b].special[d];return f||(f=c[b].special[d]={$nodes:a.$(),value:c[d],getter:null,setter:null,mediator:null},e||Object.defineProperty(c,d,{configurable:!0,enumerable:!0,
get:function(){return f.getter?f.getter.call(c):f.value},set:function(b){f.setter?f.setter.call(c,b):a.set(c,d,b,{fromSetter:!0})}})),f}}(c,j),o=function(a,b){var c,d,e;c=a.define=function(a,b,d){if(!a||"object"!=typeof a)return a;var e;if("object"==typeof b){for(e in b)c(a,e,b[e]);return a}return Object.defineProperty(a,b,d),a},d=a.defineGetter=function(c,e,f){if(!c||"object"!=typeof c)return c;b(c);var g,h;if("object"==typeof e){for(g in e)e.hasOwnProperty(g)&&d(c,g,e[g]);return c}return h=a._defineSpecial(c,e),h.getter=function(){return f.call(c,{value:h.value,key:e,self:c})},c},e=a.defineSetter=function(c,d,f){if(!c||"object"!=typeof c)return c;b(c);var g;if("object"==typeof d){for(g in d)d.hasOwnProperty(g)&&e(c,g,d[g]);return c}return a._defineSpecial(c,d).setter=function(a){return f.call(c,a,{value:a,key:d,self:c})},c}}(c,m),p=function(a,b,c){a.linkProps=function(d,e,f,g,h,i){if(!d||"object"!=typeof d)return d;c(d),f="string"==typeof f?f.split(/\s/):f,i=i||{};var j,k,l,m,n,o=function(c){
var h=[],o=c._protect=c._protect||{};if(c.fromDependency=!0,!(e+d[b].id in o)){if("object"==typeof f[0])for(m=0;m<f.length;m+=2)for(j=f[m],l="string"==typeof f[m+1]?f[m+1].split(/\s/):f[m+1],n=0;n<l.length;n++)h.push(j[l[n]]);else for(m=0;m<f.length;m++)k=f[m],j=d,h.push(j[k]);o[e+d[b].id]=1,a._defineSpecial(d,e,i.hideProperty),a.set(d,e,g.apply(d,h),c)}};if(g=g||function(a){return a},"object"==typeof f[0])for(m=0;m<f.length;m+=2)for(j=c(f[m]),l="string"==typeof f[m+1]?f[m+1].split(/\s/):f[m+1],n=0;n<l.length;n++)a._defineSpecial(j,l[n]),a._fastAddListener(j,"_rundependencies:"+l[n],o);else for(m=0;m<f.length;m++)k=f[m],j=d,a._defineSpecial(j,k),a._fastAddListener(j,"_rundependencies:"+k,o);return h!==!1&&o.call("object"==typeof f[0]?f[0]:d,{key:"object"==typeof f[0]?f[1]:f[0]}),d}}(c,j,m),q=function(a,b){a.mediate=function(c,d,e){if(!c||"object"!=typeof c)return c;b(c);var f,g,h=typeof d;if("object"==h&&!(d instanceof Array)){for(f in d)d.hasOwnProperty(f)&&a.mediate(c,f,d[f]);return c;
}for(d="string"==h?d.split(/\s/):d,f=0;f<d.length;f++)(function(b){g=a._defineSpecial(c,b),g.mediator=function(a){return e.call(c,a,g.value,b,c)},a.set(c,b,g.mediator(g.value),{fromMediator:!0})})(d[f]);return c},a.setClassFor=function(c,d,e,f){if(!c||"object"!=typeof c)return c;b(c);var g,h=typeof d;if("object"==h&&!(d instanceof Array)){for(g in d)d.hasOwnProperty(g)&&a.setClassFor(c,g,d[g],e);return c}for(d="string"==h?d.split(/\s/):d,f=f||function(a,b){var c;if(a.isMKArray)a.recreate(b);else if(a.isMKObject)a.jset(b);else for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},g=0;g<d.length;g++)a.mediate(c,d[g],function(a,b){var d;return b instanceof e?(f.call(c,b,a),d=b):d=new e(a),d});return c}}(c,m),r=function(a,b){var c;a.get=function(a,b){return a&&a[b]},c=a.set=function(d,e,f,g){if(!d||"object"!=typeof d)return d;var h,i,j,k,l,m,n,o=typeof e,p=Number.isNaN||function(a){return"number"==typeof a&&isNaN(a)};if("undefined"==o)return d;if("object"==o){for(l in e)e.hasOwnProperty(l)&&c(d,l,e[l],f);
return d}if(!d[b]||!d[b].special||!d[b].special[e])return d[e]=f,d;if(h=d[b].special[e],i=d[b].events,j=h.value,k=!h.mediator||f===j||g&&(g.skipMediator||g.fromMediator)?f:h.mediator(f,j,e,d),m={value:k,previousValue:j,key:e,node:h.$nodes[0]||null,$nodes:h.$nodes,self:d},g&&"object"==typeof g)for(l in g)m[l]=g[l];return n=(k!==j||m.force)&&!m.silent,n&&(i["beforechange:"+e]&&a._fastTrigger(d,"beforechange:"+e,m),i.beforechange&&a._fastTrigger(d,"beforechange",m)),h.value=k,(k!==j||m.force||m.forceHTML||k!==f&&!p(k))&&(m.silentHTML||i["_runbindings:"+e]&&a._fastTrigger(d,"_runbindings:"+e,m)),n&&(i["change:"+e]&&a._fastTrigger(d,"change:"+e,m),i.change&&a._fastTrigger(d,"change",m)),k===j&&!m.force&&!m.forceHTML||m.skipLinks||i["_rundependencies:"+e]&&a._fastTrigger(d,"_rundependencies:"+e,m),d},a.remove=function(c,d,e){if(!c||"object"!=typeof c)return null;var f,g,h=String(d).split(/\s/),i={keys:h};if(e&&"object"==typeof e)for(g in e)i[g]=e[g];for(g=0;g<h.length;g++)if(d=h[g],f=d in c){
i.key=d,i.value=c[d];try{delete c[d]}catch(j){}c[b]&&(a.unbindNode(c,d),a.off(c,"change:"+d+" beforechange:"+d+" _runbindings:"+d+" _rundependencies:"+d),delete c[b].special[d],i.silent||(a._fastTrigger(c,"delete",i),a._fastTrigger(c,"delete:"+d,i)))}return c}}(c,j),s=function(a,b,c,d){var e,f;e=a.defaultBinders=[function(b){var c,d=b.tagName,e=a.binders;return"INPUT"==d?c=e.input(b.type):"TEXTAREA"==d?c=e.textarea():"SELECT"==d?c=e.select(b.multiple):"PROGRESS"==d&&(c=e.progress()),c}],f=a.lookForBinder=function(a){var b,c,d=e;for(c=0;c<d.length;c++)if(b=d[c].call(a,a))return b},a.bindOptionalNode=function(a,b,c,d,e){return"object"==typeof b?g(a,b,c,d,!0):g(a,b,c,d,e,!0),a};var g=a.bindNode=function(e,h,i,j,k,l){if(!e||"object"!=typeof e)return e;c(e);var m,n,o,p,q,r,s,t,u,v,w,x,y,z;if(h instanceof Array){for(p=0;p<h.length;p++)g(e,h[p][0],h[p][1],h[p][2]||k,i);return e}if("string"==typeof h&&(o=d.trim(h).split(/\s+/),o.length>1)){for(p=0;p<o.length;p++)g(e,o[p],i,j,k,l);return e}if("object"==typeof h){
for(p in h)h.hasOwnProperty(p)&&g(e,p,h[p],i,j,k);return e}if(i&&2==i.length&&!i[1].nodeName&&(i[1].setValue||i[1].getValue||i[1].on))return g(e,h,i[0],i[1],j,k);if(s=h.indexOf("."),~s)return t=h.split("."),u=function(b){var c=b&&b.value;if(!c){c=e;for(var d=0;d<t.length-1;d++)c=c[t[d]]}g(c,t[t.length-1],i,j,b,l),b&&b.previousValue&&a.unbindNode(b.previousValue,t[t.length-1],i)},a._delegateListener(e,t.slice(0,t.length-2).join("."),"change:"+t[t.length-2],u),u(),e;if(n=a._getNodes(e,i),!n.length){if(l)return e;throw Error('Binding error: node is missing for key "'+h+'".'+("string"==typeof i?' The selector is "'+i+'"':""))}if(k=k||{},r=a._defineSpecial(e,h,"sandbox"==h),m="undefined"==typeof r.value,r.$nodes=r.$nodes.length?r.$nodes.add(n):n,e.isMK&&("sandbox"==h&&(e.$sandbox=n,e.sandbox=n[0]),e.$nodes[h]=r.$nodes,e.nodes[h]=r.$nodes[0]),"sandbox"!=h)for(p=0;p<n.length;p++)(function(c){var d,g={self:e,key:h,$nodes:n,node:c};if(null===j)d={};else if(y="sandbox"==h?null:f(c)){if(j)for(q in j)y[q]=j[q];
d=y}else d=j||{};if(d.initialize){w={value:r.value};for(q in g)w[q]=g[q];d.initialize.call(c,w)}if(d.setValue&&(x=function(a){var f=e[b].special[h].value;if(!a||a.changedNode!=c||a.onChangeValue!=f){w={value:f};for(q in g)w[q]=g[q];d.setValue.call(c,f,w)}},a._fastAddListener(e,"_runbindings:"+h,x),!m&&x()),d.getValue&&(m&&k.assignDefaultValue!==!1||k.assignDefaultValue===!0)){z={fromNode:!0};for(q in k)z[q]=k[q];a.set(e,h,d.getValue.call(c,g),z)}d.getValue&&d.on&&(v={node:c,on:d.on,instance:e,key:h,mkHandler:x,handler:function(b){if(!v.removed){var f,i,j=e[h],k={value:j,domEvent:b,originalEvent:b.originalEvent||b,preventDefault:function(){b.preventDefault()},stopPropagation:function(){b.stopPropagation()},which:b.which,target:b.target};for(i in g)k[i]=g[i];f=d.getValue.call(c,k),f!==j&&a.set(e,h,f,{fromNode:!0,changedNode:c,onChangeValue:f})}}},a.domEvents.add(v))})(n[p]);if(!k.silent){z={key:h,$nodes:n,node:n[0]||null};for(p in k)z[p]=k[p];a._fastTrigger(e,"bind:"+h,z),a._fastTrigger(e,"bind",z);
}return e}}(c,j,m,i),t=function(a,b,c){var d=a.unbindNode=function(e,f,g,h){if(!e||"object"!=typeof e)return e;c(e);var i,j,k,l,m,n,o=typeof f,p=e[b].special[f];if(f instanceof Array){for(k=0;k<f.length;k++)h=g,d(e,f[k][0],f[k][1]||h,h);return e}if("string"==o&&(j=f.split(/\s/),j.length>1)){for(k=0;k<j.length;k++)d(e,j[k],g,h);return e}if(l=f.indexOf("."),~l){m=f.split(".");var q=e;for(k=0;k<m.length-1;k++)q=q[m[k]];return a._undelegateListener(e,m.slice(0,m.length-2),"change:"+m[m.length-2]),d(q,m[m.length-1],g,h),e}if(null===f){for(f in e[b].special)e[b].special.hasOwnProperty(f)&&d(e,f,g,h);return e}if("object"==o){for(k in f)f.hasOwnProperty(k)&&d(e,k,f[k],g);return e}if(!g)return p&&p.$nodes?d(e,f,p.$nodes,h):e;if(2==g.length&&!g[1].nodeName&&(g[1].setValue||g[1].getValue||g[1].on))return d(e,f,g[0],h);if(!p)return e;for(i=a._getNodes(e,g),k=0;k<i.length;k++)a.domEvents.remove({key:f,node:i[k],instance:e}),p.$nodes=p.$nodes.not(i[k]);if(e.isMK&&(e.$nodes[f]=p.$nodes,e.nodes[f]=p.$nodes[0]||null,
"sandbox"==f&&(e.sandbox=p.$nodes[0]||null,e.$sandbox=p.$nodes)),!h||!h.silent){n={key:f,$nodes:i,node:i[0]||null};for(k in h)n[k]=h[k];a._fastTrigger(e,"unbind:"+f,n),a._fastTrigger(e,"unbind",n)}return e}}(c,j,m),u=function(a,b,c){a.parseBindings=function(d,e){var f=a.$;if(!d||"object"!=typeof d)return f();if("string"==typeof e){if(!~e.indexOf("{{"))return f.parseHTML(e.replace(/^\s+|\s+$/g,""));e=f.parseHTML(e.replace(/^\s+|\s+$/g,""))}else e=e?f(e):a.boundAll(["sandbox"]);c(d);var g,h,i,j,k,l,m,n,o,p,q=function(a){var b,c,d,e,f;if("TEXTAREA"!=a.tagName)for(b=0;b<a.childNodes.length;b++)if(e=a.childNodes[b],c=e.previousSibling,3==e.nodeType&&~e.nodeValue.indexOf("{{")){d=e.nodeValue.replace(/{{([^}]*)}}/g,'<mk-bind mk-html="$1"></mk-bind>');try{c?c.insertAdjacentHTML("afterend",d):a.insertAdjacentHTML("afterbegin",d)}catch(g){f=document.body,c?(f.appendChild(c),c.insertAdjacentHTML("afterend",d),f.removeChild(c)):(f.appendChild(a),a.insertAdjacentHTML("afterbegin",d),f.removeChild(a));
}a.removeChild(e)}else 1==e.nodeType&&q(e)};for(g=0;g<e.length;g++)q(e[g]);for(i=e.find("*").add(e),g=0;g<i.length;g++)for(j=i[g],k=j.getAttribute("mk-html"),k&&a.bindNode(d,k,j,{setValue:function(a){this.innerHTML=a}}),h=0;h<j.attributes.length;h++)l=j.attributes[h],m=l.value,n=l.name,~m.indexOf("{{")&&(o=m.match(/{{[^}]*}}/g).map(function(a){return a.replace(/{{(.*)}}/,"$1")}),1==o.length&&/^{{[^}]*}}$/g.test(m)?p=o[0]:(p=a.randomString(),a.linkProps(d,p,o,function(){var a=m;return o.forEach(function(c){a=a.replace(new RegExp("{{"+c+"}}","g"),d[b].special[c].value)}),a},!0,{hideProperty:!0})),("value"==n&&"checkbox"!=j.type||"checked"==n&&"checkbox"==j.type)&&a.lookForBinder(j)?a.bindNode(d,p,j):a.bindNode(d,p,j,{setValue:function(a){this.setAttribute(n,a)}}));return e}}(c,j,m),v=function(a,b,c,d){function selectNodes(b,c){var e,f,g,h,i,j,k,l,m=a.$();for(h=c.replace(/:sandbox/g,":bound(sandbox)").split(","),j=0;j<h.length;j++)if(i=h[j],e=/:bound\(([^(]*)\)(.*)/.exec(d.trim(i)))if(f=a.$bound(b,e[1]),
i=d.trim(e[2]))if(0===i.indexOf(">"))for(k=0;k<f.length;k++)g=f[k],l=a.randomString(),g.setAttribute(l,l),m=m.add($("["+l+'="'+l+'"]'+i,g)),g.removeAttribute(l);else m=m.add(f.find(i));else m=m.add(f);else m=m.add(i);return m}var e,f;e=a.selectAll=function(c,d){var e;return c&&c[b]&&"string"==typeof d?/:sandbox|:bound\(([^(]*)\)/.test(d)?selectNodes(c,d):(e=c&&c[b]&&c[b].special,e=e&&e.sandbox&&e.sandbox.$nodes,e&&e.find(d)):a.$()},a.select=function(c,d){var e;return c&&c[b]&&"string"==typeof d?/:sandbox|:bound\(([^(]*)\)/.test(d)?selectNodes(c,d)[0]||null:(e=c&&c[b]&&c[b].special,e=e&&e.sandbox&&e.sandbox.$nodes&&e.sandbox.$nodes[0],e&&e.querySelector(d)):a.$()},f=a.boundAll=function(d,e){var f,g,h,i,j=a.$;if(!d||"object"!=typeof d)return j();if(c(d),f=d[b].special,e=e?e:"sandbox",g="string"==typeof e?e.split(/\s+/):e,g.length<=1)return g[0]in f?f[g[0]].$nodes:j();for(h=j(),i=0;i<g.length;i++)h=h.add(f[g[i]].$nodes);return h},a.$bound=function(a,b){return f(a,b)},a.bound=function(a,d){
if(!a||"object"!=typeof a)return null;c(a);var e,f,g=a[b].special;if(d=d?d:"sandbox",e="string"==typeof d?d.split(/\s+/):d,e.length<=1)return e[0]in g?g[e[0]].$nodes[0]||null:null;for(f=0;f<e.length;f++)if(e[f]in g&&g[e[f]].$nodes.length)return g[e[f]].$nodes[0];return null},a._getNodes=function(b,c){return"string"==typeof c&&!/</.test(c)&&/:sandbox|:bound\(([^(]*)\)/.test(c)?selectNodes(b,c):a.$(c)}}(c,j,m,i),w=function(a,b,c){a.trigger=function(a,d){var e,f,g,h,i,j=a&&"object"==typeof a&&a[b]&&a[b].events;if(!j)return a;if(d)for(e=c.toArray(arguments,2),d=d.split(/\s/),f=0;f<d.length;f++)if(h=j[d[f]])for(g=-1,l=h.length;++g<l;)(i=h[g]).callback.apply(i.ctx,e);return a},a._fastTrigger=function(a,c,d){var e,f,g,h=a[b].events[c];if(h)for(e=-1,f=h.length;++e<f;)(g=h[e]).callback.call(g.ctx,d)}}(c,j,i),x=function(a,b,c){var d,e;d=a._on=function(c,d,e,f){if(!c)return c;b(c);var g,h=d.lastIndexOf("@");return~h?(g=d.slice(0,h).replace(/([^@]*)@/g,function(a,b){return(b||"*")+"."}).replace(/\.$/,".*")||"*",
d=d.slice(h+1),a._delegateListener(c,g,d,e,f||c)):a._addListener(c,d,e,f),c},e=a.on=function(a,f,g,h,i,j){if(!a)return a;b(a);var k,l;if("object"==typeof f&&!(f instanceof Array)){for(l in f)f.hasOwnProperty(l)&&e(a,l,f[l],g,h);return a}if(!g)throw Error('callback is not function for event(s) "'+f+'"');for(f=f instanceof Array?f:c.trim(f).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"boolean"!=typeof h&&"undefined"!=typeof h&&(k=i,i=h,h=k),l=0;l<f.length;l++)d(a,f[l],g,i,j);return h===!0&&g.call(i||a,{triggeredOnInit:!0}),a}}(c,m,i),y=function(a,b,c,d){var e,f;e=a._off=function(c,d,e,f){if(!c)return c;b(c);var g,h=d.lastIndexOf("@");return~h?(g=d.slice(0,h),d=d.slice(h+1).replace(/@/g,"."),a._undelegateListener(c,g,d,e,f)):a._removeListener(c,d,e,f),c},f=a.off=function(a,b,g,h){if(!a||"object"!=typeof a||!a[d])return a;var i;if("object"==typeof b&&!(b instanceof Array)){for(i in b)b.hasOwnProperty(i)&&f(a,i,b[i],g);return a}if(!b&&!g&&!h&&a[d])return a[d].events={},a;if(b=c.trim(b).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),
"object"!=typeof a)return a;for(i=0;i<b.length;i++)e(a,b[i],g,h);return a}}(c,m,i,j),z=function(a,b,c){var d;a._fastAddListener=function(b,d,e,f,g){var h=b[c].events,i=h[d]||(h[d]=[]);return i.push({callback:e,context:f,ctx:f||b,name:d}),0===d.indexOf("change:")&&a._defineSpecial(b,d.replace("change:","")),b},d=a._addListener=function(d,e,f,g,h){if(!d||"object"!=typeof d)return d;b(d);var i,j,k,l,m=g||d,n=d[c].events,o=n[e]||(n[e]=[]),p=o.length,q=/([^\:\:]+)(::([^\(\)]+)?(\((.*)\))?)?/,r={callback:f,context:g,ctx:m,name:e};for(i=0;p>i;i++)if(j=o[i],(j.callback==f||j.callback==f._callback)&&j.context==g)return d;if(h){k={};for(i in h)k[i]=h[i];for(i in r)k[i]=r[i]}else k=r;return o.push(k),l=q.exec(e),l&&l[2]?a._addDOMListener(d,l[3]||"sandbox",l[1],l[5],f,m,k):0===e.indexOf("change:")&&a._defineSpecial(d,e.replace("change:","")),a._fastTrigger(d,"addevent:"+e),a._fastTrigger(d,"addevent"),d}}(c,m,j),A=function(a,b){a._removeListener=function(c,d,e,f,g){if(!c||"object"!=typeof c||!c[b]||!c[b].events)return c;
var h,i,j,k=c[b].events[d]||[],l=c[b].events[d]=[],m=/([^\:\:]+)(::([^\(\)]+)(\((.*)\))?)?/,n=0,o=k.length;if(g=g||{},j=m.exec(d),j&&j[2])a._removeDOMListener(c,j[3],j[1],j[5],e,f);else{for(i=0;o>i;i++)h=k[i],(h.howToRemove?!h.howToRemove(h,g):e&&e!==h.callback&&e._callback!==h.callback||f&&f!==h.context)&&(l[n++]=h);l.length||delete c[b].events[d]}return c}}(c,j),B=function(a,b,c){var d=a._delegateTreeListener=function(b,c,f,g,h,i){if(!b||"object"!=typeof b)return b;var j;return j=function(a){var j=b[a.key];j&&(e(j,c,f,g,h,i),d(j,c,f,g,h,i))},each(b,function(a){e(a,c,f,g,h,i),d(a,c,f,g,h,i)}),j._callback=g,a._addListener(b,"change",j,h,i),b},e=a._delegateListener=function(d,f,g,h,i,j){if(!d||"object"!=typeof d)return d;b(d);var k,l=/([^\.]+)\.(.*)/.exec(f),m=l?l[1]:f;if(f=l?l[2]:"",j=j||{},m)if("*"==m)if(d.isMKArray)k=function(a){(a&&a.added?a.added:d).forEach(function(a){a&&e(a,f,g,h,i,j)})},k._callback=h,a._addListener(d,"add",k,i,j),k();else{if(!d.isMKObject)throw Error('"*" events are only allowed for MK.Array and MK.Object');
k=function(a){var b=d[a.key];b&&a&&a.key in d[c].keys&&e(b,f,g,h,i,j)},d.each(function(a){e(a,f,g,h,i,j)}),k._callback=h,a._addListener(d,"change",k,i,j)}else k=function(b){if(!b||!b._silent){var k,l,n,o=d[m],p=!0;if(j.path=f,j.previousValue=b&&b.previousValue||j.previousValue&&j.previousValue[m],b&&b.previousValue&&b.previousValue[c]&&a._undelegateListener(b.previousValue,f,g,h,i,j),"object"==typeof o&&o&&e(o,f,g,h,i,j),0===g.indexOf("change:")&&(k=g.replace("change:",""),!f&&j.previousValue&&j.previousValue[k]!==o[k])){if(n=j.previousValue[c].events[g])for(l=0;l<n.length;l++)n[l].path===f&&(p=!1);p&&a.set(o,k,o[k],{force:!0,previousValue:j.previousValue[k],previousObject:j.previousValue,_silent:!0})}}},k._callback=h,a._addListener(d,"change:"+m,k,i,j),k();else a._addListener(d,g,h,i,j)}}(c,m,j),C=function(a,b){var c=a._undelegateListener=function(d,e,f,g,h,i){if(!d||"object"!=typeof d)return d;var j,k,l=/([^\.]+)\.(.*)/.exec(e),m=l?l[1]:e,n=e;if(e=l?l[2]:"",m)if("*"==m){if(d.isMKArray){
if(g)c(d,e,"add",g,h,i);else for(j=d[b].events.add||[],k=0;k<j.length;k++)j[k].path==n&&c(d,e,"add",j[k].callback);d.forEach(function(a){a&&c(a,e,f,g,h)})}else if(d.isMKObject){if(g)c(d,e,"change",g,h);else for(j=d[b].events.change||[],k=0;k<j.length;k++)j[k].path==n&&c(d,e,"change",j[k].callback);d.each(function(a){a&&c(a,e,f,g,h)})}}else{if(g)a._removeListener(d,"change:"+m,g,h,i);else for(j=d[b].events["change:"+m]||[],k=0;k<j.length;k++)j[k].path==n&&a._removeListener(d,"change:"+m,j[k].callback);"object"==typeof d[m]&&c(d[m],e,f,g,h,i)}else a._removeListener(d,f,g,h,i)}}(c,j),D=function(a,b){var c={};a.domEvents={add:function(d){var e=a.$;d.node&&("function"==typeof d.on?d.on.call(d.node,d.handler):e(d.node).on(d.on.split(/\s/).join(".mk ")+".mk",d.handler)),(c[d.instance[b].id]=c[d.instance[b].id]||[]).push(d)},remove:function(d){var e,f,g=c[d.instance[b].id],h=a.$;if(g)for(f=0;f<g.length;f++)e=g[f],e.node===d.node&&(e.mkHandler&&a._off(d.instance,"_runbindings:"+d.key,e.mkHandler),
"string"==typeof e.on&&h(d.node).off(e.on+".mk",e.handler),e.removed=!0,c[d.instance[b].id].splice(f--,1))}}}(c,j),E=function(a,b,c){a._addDOMListener=function(d,e,f,g,h,i,j){if(!d||"object"!=typeof d)return d;b(d),g=g||null,j=j||{};var k=function(b){var c,f,j=this,k=a.$,l=k(j),m={self:d,node:j,$nodes:l,key:e,domEvent:b,originalEvent:b.originalEvent||b,preventDefault:function(){b.preventDefault()},stopPropagation:function(){b.stopPropagation()},which:b.which,target:b.target};g?(c="x"+String(Math.random()).split(".")[1],j.setAttribute(c,c),f="["+c+'="'+c+'"] '+g,k(b.target).is(f+","+f+" *")&&h.call(i,m),j.removeAttribute(c)):h.call(i,m)},l=f+"."+d[c].id+e,m=function(a){a&&a.$nodes&&a.$nodes.on(l,k)},n=function(a){a&&a.$nodes&&a.$nodes.off(l,k)};return a._defineSpecial(d,e),m._callback=n._callback=h,a._addListener(d,"bind:"+e,m,i,j),a._addListener(d,"unbind:"+e,n,i,j),m({$nodes:d[c].special[e]&&d[c].special[e].$nodes}),d}}(c,m,j),F=function(a,b){a._removeDOMListener=function(c,d,e,f,g,h,i){
return c&&"object"==typeof c&&c[b]&&c[b].events?(f=f||null,i=i||{},d&&c[b].special[d]&&(c[b].special[d].$nodes.off(e+"."+c[b].id+d),a._removeListener(c,"bind:"+d,g,h,i),a._removeListener(c,"unbind:"+d,g,h,i)),c):c}}(c,j),G=function(a,b){var c=a.once=function(d,e,f,g,h){var i;if(!d||"object"!=typeof d)return d;if("object"==typeof e){for(i in e)e.hasOwnProperty(i)&&c(d,i,e[i],f,g);return d}if(!f)throw Error('callback is not function for event "'+e+'"');for(b(d),e=e.split(/\s/),i=0;i<e.length;i++)!function(b){var c=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}(f);c._callback=f,a._on(d,b,c,g)}(e[i]);return d}}(c,m),H=function(a,b,c){var d=a.onDebounce=function(b,e,f,g,h,i,j){if(!b||"object"!=typeof b)return b;var k,l;if("object"==typeof e){for(l in e)e.hasOwnProperty(l)&&d(b,l,e[l],f,g,h,i);return b}return"number"!=typeof g&&(j=i,i=h,h=g,g=0),k=c.debounce(f,g),k._callback=f,a.on(b,e,k,h,i,j)}}(c,m,i),I=function(a,b,c,d){return a.sym=d,a.initMK=function(a){
return a[d]||Object.defineProperty(a,d,{value:{events:{},special:{},id:"mk"+Math.random()},enumerable:!1,configurable:!1,writable:!1}),a},a.$=c,a.$b=a.balalaika=b,a.useAs$=function(b){return a.$=this.$=c=b},a}(c,g,h,j),J=function(a,b){if(!a)throw Error("Class function is missing");if(![].forEach)throw Error("Internet Explorer 8 requires to use es5-shim: https://github.com/es-shims/es5-shim");var c=(b.toArray,b.extend),d=b.sym,e=a({isMK:!0,on:function(a,c,d,e,f){return b.on(this,a,c,d,e,f)},onDebounce:function(a,c,d,e,f,g){return b.onDebounce(this,a,c,d,e,f,g)},_on:function(a,c,d,e){return b._on(this,a,c,d,e)},once:function(a,c,d){return b.once(this,a,c,d)},off:function(a,c,d){return b.off(this,a,c,d)},_off:function(a,c,d){return b._off(this,a,c,d)},trigger:function(){var a=b.toArray(arguments);return a.unshift(this),b.trigger.apply(b,a)},_trigger:function(){var a=b.toArray(arguments);return a.unshift(this),b._trigger.apply(b,a)},bindNode:function(a,c,d,e,f){return b.bindNode(this,a,c,d,e,f);
},bindOptionalNode:function(a,c,d,e){return b.bindOptionalNode(this,a,c,d,e)},unbindNode:function(a,c,d){return b.unbindNode(this,a,c,d)},boundAll:function(a){return b.boundAll(this,a)},$bound:function(a){return b.boundAll(this,a)},bound:function(a){return b.bound(this,a)},selectAll:function(a){return b.selectAll(this,a)},$:function(a){return b.selectAll(this,a)},select:function(a){return b.select(this,a)},_defineSpecial:function(a){return b._defineSpecial(this,a)},eq:function(a){return"object"==typeof a&&null!==a&&this[d]&&a[d]&&this[d].id==a[d].id},defineGetter:function(a,c){return b.defineGetter(this,a,c)},defineSetter:function(a,c){return b.defineSetter(this,a,c)},mediate:function(a,c){return b.mediate(this,a,c)},setClassFor:function(a,c,d){return b.setClassFor(this,a,c,d)},linkProps:function(a,c,d,e){return b.linkProps(this,a,c,d,e)},get:function(a){return this[a]},set:function(a,c,d){return b.set(this,a,c,d)},remove:function(a,c){return b.remove(this,a,c)},define:function(a,c){return b.define(this,a,c);
},delay:function(a,c,d){return b.delay(this,a,c,d)},_initMK:function(){var a=this;return a[d]?a:(b.initMK(a),a.nodes=a.nodes={},a.$nodes=a.$nodes={},a.sandbox=a.sandbox||null,a.$sandbox=a.$sandbox||e.$(),a.Matreshka=e,a)},toString:function(){return"[object Matreshka]"},constructor:function Matreshka(){return this._initMK()}});return c(e,b,{version:"dev",Class:a,Matreshka:e,isXDR:a.isXDR,to:function(a){var b,c;if("object"==typeof a)if("length"in a){for(b=[],c=0;c<a.length;c++)b[c]=e.to(a[c]);b=(new e.Array).recreate(b)}else{b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=e.to(a[c]));b=new e.Object(b)}else b=a;return b}}),e}(b,I),K=function(a){if(!a)throw new Error("Matreshka is missing");var b,c=a.sym,d={"extends":a,isMKObject:!0,renderer:null,constructor:function MatreshkaObject(a){return this.jset(a)},keys:function(){var a,b=this._initMK(),d=b[c].keys,e=[];for(a in d)d.hasOwnProperty(a)&&e.push(a);return e},_initMK:function(){var b,d=this;return d[c]?d:(a.prototype._initMK.call(d,arguments),
d[c].keys={},a._fastAddListener(d,"addevent:modify",function(e){b||(a._fastAddListener(d,"change",function(b){b&&b.key in d[c].keys&&!b.silent&&a._fastTrigger(d,"modify",b)}),a._fastAddListener(d,"delete",function(b){b&&b.key in d[c].keys&&(d.removeDataKeys(b.key),b.silent||a._fastTrigger(d,"modify",b))}),b=!0)}),d)},hasOwnProperty:function(a){return this._initMK()[c].keys.hasOwnProperty(a)},toObject:function(){var a,b=this._initMK(),d={},e=b[c].keys;for(a in e)e.hasOwnProperty(a)&&(d[a]=b[a]);return d},toNative:function(){return this.toObject()},toJSON:function(){var a,b=this._initMK(),d={},e=b[c].keys;for(a in e)e.hasOwnProperty(a)&&(d[a]=b[a]&&b[a].toJSON?b[a].toJSON():b[a]);return d},keyOf:function(a){var b,d=this._initMK(),e=d[c].keys;for(b in e)if(e.hasOwnProperty(b))if(a&&a.isMK){if(a.eq(d[b]))return b}else if(a===d[b])return b;return null},jset:function(a,d,e){var f=this._initMK(),g=typeof a;if("undefined"==g)return f;if(a&&"object"==g){a=a.toJSON?a.toJSON():a;for(b in a)f[c].keys[b]=1,
f._defineSpecial(b),f.set(b,a[b],d);return f}return f[c].keys[a]=1,f._defineSpecial(a),f.set(a,d,e)},addDataKeys:function(a){var d=this._initMK(),e=arguments;if(!e.length)return d;for(a=e.length>1?e:a instanceof Array?a:String(a).split(/\s/),b=0;b<a.length;b++)d[c].keys[a[b]]=1,d._defineSpecial(a[b]);return d},removeDataKeys:function(a){var d=this._initMK(),e=arguments;if(!e.length)return d;for(a=e.length>1?e:a instanceof Array?a:String(a).split(/\s/),b=0;b<a.length;b++)delete d[c].keys[a[b]];return d},each:function(a,b){var d,e=this._initMK();for(d in e[c].keys)e[c].keys.hasOwnProperty(d)&&a.call(b,e[d],d,e);return e}};return d["undefined"!=typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var a=this,b=a.keys(),c=0;return{next:function(){return c>b.length-1?{done:!0}:{done:!1,value:a[b[c++]]}}}},a.Object=a.Class(d)}(J),L=function(a){if(!a)throw new Error("Matreshka is missing");var b=Array.prototype,c=a.sym,d=a.toArray,e=(b.slice,a.isXDR),f=function(a,b,c,d){if(a.length!=b.length)return!1;
for(c=0,d=a.length;d>c;c++)if(a[c]&&a[c].isMK?!a[c].eq(b[c]):a[c]!==b[c])return!1;return!0},g=e?function(a){var b,c,d=this,e=d.length,f=a&&a.isMK;for(b=0;e>b;b++)if(c=d[b],f?a.eq(c):a===c)return b;return-1}:b.indexOf,h=e?function(a){var b,c,d=this,e=d.length,f=a&&a.isMK;for(b=e-1;b>=0;b--)if(c=d[b],f?a.eq(c):a===c)return b;return-1}:b.lastIndexOf,i=function(b,d,e){var f,g=d.added,h=d.removed,i=b[c].events;if(!d.silent){if(e&&i[e]&&a._fastTrigger(b,e,d),g.length&&(i.add&&a._fastTrigger(b,"add",d),i.addone))for(f=0;f<g.length;f++)a._fastTrigger(b,"addone",{self:b,added:g[f]});if(h.length&&(i.remove&&a._fastTrigger(b,"remove",d),i.removeone))for(f=0;f<h.length;f++)a._fastTrigger(b,"removeone",{self:b,removed:h[f]});(g.length||h.length)&&i.modify&&a._fastTrigger(b,"modify",d)}(g.length||h.length)&&(d.dontRender||b.processRendering(d))},j=function(a,b){b=b||[];var c,d=a.length-b.length;for(c=0;c<b.length;c++)a[c]=b[c];for(c=0;d>c;c++)a.remove(c+b.length,{silent:!0});return a.length=b.length,
a},k=function(c,f){var g,h;switch(c){case"forEach":return function(){var a=this;return b[c].apply(e?a.toArray():a,arguments),a};case"map":case"filter":case"slice":return function(){var d=this;return a.Array.from(b[c].apply(e?d.toArray():d,arguments))};case"every":case"some":case"reduce":case"reduceRight":case"join":return function(){var a=this;return b[c].apply(e?a.toArray():a,arguments)};case"sort":case"reverse":return function(){if(this.length){var a=this._initMK(),k=arguments,l=d(k),m=f?k[k.length-1]||{}:{},n=a.toArray(),o=b[c].apply(n,l);f&&l.pop(),e?(n=a.toArray(),o=b[c].apply(n,l),j(a,n)):o=b[c].apply(a,l),h={returns:o,args:l,originalArgs:k,method:c,self:a,added:[],removed:[]};for(g in m)h[g]=m[g];return i(a,h,c),a}};case"pop":case"shift":return function(){if(this.length){var a,k,l,m,n=this._initMK(),o=arguments,p=d(o),q=f?o[o.length-1]||{}:{};f&&p.pop(),e?(a=n.toArray(),k=b[c].apply(a,p),j(n,a)):k=b[c].apply(n,p),h={returns:k,args:p,originalArgs:o,method:c,self:n,added:l=[],removed:m=[k]
};for(g in q)h[g]=q[g];return i(n,h,c),k}};case"push":case"unshift":return function(){var a,k,l,m,n=this._initMK(),o=arguments,p=d(o),q=f?o[o.length-1]||{}:{};if(f&&p.pop(),!p.length)return n.length;if(!q.skipMediator&&"function"==typeof n._itemMediator)for(g=0;g<p.length;g++)p[g]=n._itemMediator.call(n,p[g],g);e?(a=n.toArray(),k=b[c].apply(a,p),j(n,a)):k=b[c].apply(n,p),h={returns:k,args:p,originalArgs:o,method:c,self:n,added:l=p,removed:m=[]};for(g in q)h[g]=q[g];return i(n,h,c),k};case"splice":return function(){var k,l,m,n=this._initMK(),o=arguments,p=d(o),q=f?o[o.length-1]||{}:{},r=d(p,2);if(f&&p.pop(),!q.skipMediator&&"function"==typeof n._itemMediator)for(g=2;g<p.length;g++)p[g]=n._itemMediator.call(n,p[g],g);if(e?(k=n.toArray(),l=b[c].apply(k,p),j(n,k)):l=b[c].apply(n,p),m=l,r.length||m.length){h={returns:l,args:p,originalArgs:o,method:c,self:n,added:r,removed:m};for(g in q)h[g]=q[g];i(n,h,c)}return a.Array.from(l)}}},l={"extends":a,isMKArray:!0,length:0,itemRenderer:null,renderIfPossible:!0,
Model:null,constructor:function MatreshkaArray(a){var b,c=this._initMK(),d=arguments.length;if(1==d&&"number"==typeof a)c.length=a;else{for(b=0;d>b;b++)c[b]=arguments[b];c.length=arguments.length}return c},mediateItem:function(a){var b,c=this,d=c.length;for(c._itemMediator=a,b=0;d>b;b++)c[b]=a.call(c,c[b],b);return c},recreate:function(a,b){a=a||[];var d,e,f,h,j,k,l,m=this._initMK(),n=m.length-a.length,o=m.toArray();if(b=b||{},m._itemMediator&&!b.skipMediator){for(d=[],e=0;e<a.length;e++)d[e]=m._itemMediator.call(m,a[e],e);a=d}for(e=0;e<a.length;e++)m[e]=a[e];for(e=0;n>e;e++){try{delete m[e+a.length]}catch(p){}delete m[c].special[e+a.length]}if(m.length=a.length,b.silent&&b.dontRender)return m;if(l=m.toArray(),l.length)for(k=[],f=0,e=0;e<o.length;e++)~g.call(l,o[e])||(k[f++]=o[e]);else k=o;if(o.length)for(j=[],f=0,e=0;e<l.length;e++)~g.call(o,l[e])||(j[f++]=l[e]);else j=l;h={added:j,removed:k,was:o,now:l,method:"recreate",self:m};for(e in b)h[e]=b[e];return i(m,h,"recreate"),m},toArray:function(){
var a,b=this,c=[],d=b.length;for(c=[],a=0;d>a;a++)c[a]=b[a];return c},toNative:function(){return this.toArray()},_initMK:function(){var b,d=this;return d[c]?d:(b=function(){var a=d.Model;a&&d.mediateItem(function(b){return b&&b.isMK&&(b&&b.instanceOf?b.instanceOf(a):b instanceof a)?b:new a(b&&b.toJSON?b.toJSON():b,d)})},a.prototype._initMK.call(d),a._fastAddListener(d,"change:Model",b),a._fastAddListener(d,"change:itemRenderer",function(){d.rerender({forceRerender:!0})}),b(),d)},_renderOne:function(b,d){if(b&&"object"==typeof b&&this.renderIfPossible&&!d.dontRender){b[c]||(b._initMK?b._initMK():a.initMK(b));var e,f,g,h,i,j=this,k=j[c].id,l=b.renderer||j.itemRenderer,m=l===b.renderer?b:j,n=b[c].arraysNodes=b[c].arraysNodes||{},o=n[k];if(l){if(d.moveSandbox&&(o=b.bound(["sandbox"]))&&(n[k]=o),o&&d.forceRerender){for(h=b.boundAll(["sandbox"]),i=0;i<h.length;i++)if(o==h[i]){b.unbindNode("sandbox",o);break}o=n[k]=null}if(!o){if("function"==typeof l&&(l=l.call(m,b)),"string"!=typeof l||/<|{{/.test(l))f=l;else{
if(f=m._getNodes(l),!(f=f&&f[0]))throw Error("renderer node is missing: "+l);f=f.innerHTML}e="string"==typeof f?j.useBindingsParser!==!1?a.parseBindings(b,f):a.$.parseHTML(f.replace(/^\s+|\s+$/g,"")):a.$(f),b.bindRenderedAsSandbox!==!1&&e.length&&a.bindNode(b,"sandbox",e),o=e[0],n[k]=o,g={node:o,$nodes:e,self:b,parentArray:j},b.onRender&&b.onRender(g),j.onItemRender&&j.onItemRender(b,g),a._fastTrigger(b,"render",g)}return o}}},processRendering:function(a){var b,d,e,f=this,g=f[c],h=g.id,i=f.length,j=function(a){var d;return a&&a.isMK?((d=a[c].arraysNodes)&&(b=d[h]),b):void 0},k=g.special.container||g.special.sandbox;if(k=k&&k.$nodes,k=k&&k[0],!k)return f;switch(a.method){case"push":for(d=i-a.added.length;i>d;d++)(b=f._renderOne(f[d],a))&&k.appendChild(b);break;case"unshift":for(d=a.added.length-1;d+1;d--)(b=f._renderOne(f[d],a))&&(k.children?k.insertBefore(b,k.firstChild):k.appendChild(b));break;case"pull":case"pop":case"shift":for(d=0;d<a.removed.length;d++)(b=j(a.removed[d]))&&k.removeChild(b);
break;case"sort":case"reverse":for(d=0;i>d;d++)e=f[d],(b=e&&e.isMK&&e[c].arraysNodes[h])&&k.appendChild(b);break;case"rerender":if(a.forceRerender)for(d=0;i>d;d++)(b=j(f[d]))&&k.removeChild(b);for(d=0;i>d;d++)(b=f._renderOne(f[d],a))&&k.appendChild(b);break;case"recreate":case"splice":for(d=0;d<a.removed.length;d++)(b=j(a.removed[d]))&&k.removeChild(b);for(d=0;i>d;d++)(b=f._renderOne(f[d],a))&&k.appendChild(b)}return f},rerender:function(a){var b,c={method:"rerender"};if(a&&"object"==typeof a)for(b in a)c[b]=a[b];return this.processRendering(c)},hasOwnProperty:function(a){return"length"==a||a<this.length&&a>=0},toJSON:function(){var a,b=this,c=[],d=b.length;for(a=0;d>a;a++)b[a]&&b[a].toJSON?c.push(b[a].toJSON()):c.push(b[a]);return c},concat:function(){var b,c,d,e=arguments,f=this.toArray();for(c=0;c<e.length;c++)if(b=e[c],b instanceof Array||b instanceof a.Array||b&&b.instanceOf&&b.instanceOf(a.Array))for(d=0;d<b.length;d++)f.push(b[d]);return a.Array.from(f)},pull:function(a,b){var c,d,e,g,h=this._initMK(),k=h.toArray(),l=a,m=typeof a;
if("number"!=m&&"string"!=m&&(a=h.indexOf(a),!~a))return null;if(c=k.splice(a,1)[0]||null,!f(k,h)){b=b||{},j(h,k,b),e={returns:c,args:[l],method:"pull",self:h,added:[],removed:d=c?[c]:[]};for(g in b)e[g]=b[g];i(h,e,"pull")}return c},indexOf:g,lastIndexOf:h,toString:function(){return this.toArray().join(",")}};return"push pop unshift shift sort reverse splice map filter slice every some reduce reduceRight forEach join".split(" ").forEach(function(a){l[a]=k(a)}),"push pop unshift shift sort reverse splice".split(" ").forEach(function(a){l[a+"_"]=k(a,1)}),l.each=l.forEach,l["undefined"!=typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var a=this,b=0;return{next:function(){return b>a.length-1?{done:!0}:{done:!1,value:a[b++]}}}},a.Array=a.Class(l),a.Array.of=function(){var b,c=new a.Array,d=arguments;for(c.length=d.length,b=0;b<d.length;b++)c[b]=d[b];return c},a.Array.from=function(b,c,d){var e,f=new a.Array;for(f.length=b.length,e=0;e<b.length;e++)f[e]=c?c.call(d,b[e],e,b):b[e];return f;
},a.Array}(J),M=function(a,b,c,d){return a}(J,K,L),N=function(a){return a}(g),O=function(a){return a}(b),P=function(a){return a}(I),M.version="1.1.0-alpha.1",function(){"undefined"!=typeof a&&("function"==typeof define&&define.amd?(define("matreshka",function(){return M}),define("balalaika",function(){return N}),define("xclass",function(){return O}),define("matreshka-magic",function(){return P}),define(function(){return M})):"object"==typeof exports?a.module.exports=M:(a.Matreshka=a.MK=M,a.$b=N,a.Class=O))}()}(this);
//# sourceMappingURL=matreshka.min.map