/*
	Matreshka v1.0.6 (2015-08-10)
	JavaScript Framework by Andrey Gubanov
	Released under the MIT license
	More info: http://matreshka.io
*/

!function(a,b){"function"==typeof define&&define.amd?define("xclass",b):a.Class=b()}(this,function(){var a=function(a){return!!a&&("[object Arguments]"===a.toString()||"object"==typeof a&&null!==a&&"length"in a&&"callee"in a)},b=function(){var a,b,c=-1;return"Microsoft Internet Explorer"==navigator.appName&&(a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=b.exec(a)&&(c=parseFloat(RegExp.$1))),c}(),c=document.documentMode,d=8===c,e="Internet Explorer "+b+" doesn't support Class function";if(~b&&8>b)throw Error(e);if(8>c)throw Error(e+'. Switch your "Document Mode" to "Standards"');var f=function(b){var c=i=b.constructor!==Object?b.constructor:function EmptyConstructor(){},e=b["extends"]=b["extends"]||b.extend,g=e&&e.prototype,h=b["implements"]=b["implements"]||b.implement,i=c,j={};if(delete b.extend,delete b.implement,g){for(var k in g)j[k]="function"==typeof g[k]?function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d)};
}(g[k]):g[k];j.constructor=function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d)}}(g.constructor)}return d?(b.prototype=null,b.constructor=null,c=function(){if(this instanceof c){var a=new XDomainRequest;for(var b in c.prototype)"constructor"!==b&&(a[b]=c.prototype[b]);return a.hasOwnProperty=c.prototype.hasOwnProperty,i.apply(a,arguments),a}i.apply(this,arguments)},b.constructor=c,c.prototype=c.fn=b,c.parent=j,e&&f.IEInherits(c,e)):(b.constructor=c,c.prototype=c.fn=b,c.parent=j,e&&f.inherits(c,e)),h&&h.validate(c.prototype),c.same=function(){return function(){return c.apply(this,arguments)}},this instanceof f?new c:c};return f.inherits=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a;for(var e in c)a.prototype[e]=c[e];"undefined"!=typeof Symbol&&c[Symbol.iterator]&&(a.prototype[Symbol.iterator]=c[Symbol.iterator]),a.prototype.instanceOf=function(a){return this instanceof a};
},f.IEInherits=function(a,b){for(var c,d=a.prototype.hasOwnProperty,e=a.prototype.constructor,f=Object.prototype.hasOwnProperty;b;)c=c||b.prototype.hasOwnProperty,a.prototype=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}(b.prototype,a.prototype),b=b.prototype&&b.prototype["extends"]&&b.prototype["extends"].prototype;d!==f?a.prototype.hasOwnProperty=d:c!==f&&(a.prototype.hasOwnProperty=c),a.prototype.constructor=e,a.prototype.instanceOf=function(b){for(var c=a;c;){if(c===b)return!0;c=c.prototype["extends"]}return!1}},f.Interface=function Interface(a,b){var c,d={},e=function(a){return"object"==typeof a&&null!==a&&"length"in a};if(a instanceof Interface){for(var f in a.propsMap)d[f]=1;c=e(b)?b:[].slice.call(arguments,1)}else c=e(a)?a:arguments;for(f=0;f<c.length;f++)d[c[f]]=1;this.propsMap=d,this.validate=function(a){for(var b in this.propsMap)if("function"!=typeof a[b])throw Error('Interface error: Method "'+b+'" is not implemented in '+(a.constructor.name||a.name||"given")+" prototype");
}},f.isXDR=d,f}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/polyfills/addeventlistener",b):b()}(this,function(){!function(a,b,c,d){b[c]||(Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){var b=b||a.event;b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(window,document,"addEventListener","removeEventListener")}),function(a,b){"function"==typeof define&&define.amd?define("balalaika",["matreshka_dir/polyfills/addeventlistener"],b):a.$b=b()}(this,function(){return function(a,b,c,d,e,f,g,h,i,j,k,l){return l=function(a,b){return new l.i(a,b)},l.i=function(d,e){c.push.apply(this,d?d.nodeType||d==a?[d]:""+d===d?/</.test(d)?((h=b.createElement(e||"div")).innerHTML=d,
h.children):(e&&l(e)[0]||b).querySelectorAll(d):/f/.test(typeof d)?/c/.test(b.readyState)?d():l(b).on("DOMContentLoaded",d):d:c)},l.i[k="prototype"]=(l.extend=function(a){for(j=arguments,h=1;h<j.length;h++)if(k=j[h])for(i in k)a[i]=k[i];return a})(l.fn=l[k]=c,{on:function(a,b){return a=a.split(d),this.map(function(c){(d[h=a[0]+(c.b$=c.b$||++e)]=d[h]||[]).push([b,a[1]]),c["add"+f](a[0],b)}),this},off:function(a,b){return a=a.split(d),k="remove"+f,this.map(function(c){if(j=d[a[0]+c.b$],h=j&&j.length)for(;i=j[--h];)b&&b!=i[0]||a[1]&&a[1]!=i[1]||(c[k](a[0],i[0]),j.splice(h,1));else!a[1]&&c[k](a[0],b)}),this},is:function(a){return h=this[0],i=!!h&&(h.matches||h["webkit"+g]||h["moz"+g]||h["ms"+g]),!!i&&i.call(h,a)}}),l}(window,document,[],/\.(.+)/,0,"EventListener","MatchesSelector")}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/polyfills/classlist",b):b()}(this,function(){function DOMTokenList(a){this.el=a;for(var b=a.className.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c++)d.call(this,b[c]);
}function defineElementGetter(a,b,c){Object.defineProperty?Object.defineProperty(a,b,{get:c}):a.__defineGetter__(b,c)}var a=function(a,b){return"boolean"==typeof b?this[b?"add":"remove"](a):this[this.contains(a)?"remove":"add"](a),this.contains(a)};if(window.DOMTokenList){var b=document.createElement("a");b.classList.toggle("x",!1),b.className&&(window.DOMTokenList.prototype.toggle=a)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var c=Array.prototype,d=c.push,e=c.splice,f=c.join;DOMTokenList.prototype={add:function(a){this.contains(a)||(d.call(this,a),this.el.className=this.toString())},contains:function(a){return-1!=this.el.className.indexOf(a)},item:function(a){return this[a]||null},remove:function(a){if(this.contains(a)){for(var b=0;b<this.length&&this[b]!=a;b++);e.call(this,b,1),this.el.className=this.toString()}},toString:function(){return f.call(this," ")},toggle:a},window.DOMTokenList=DOMTokenList,defineElementGetter(Element.prototype,"classList",function(){
return new DOMTokenList(this)})}}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/balalaika-extended",["balalaika","matreshka_dir/polyfills/classlist"],b):b(a.$b)}(this,function(a){var b,c,d="classList";if(!a)throw new Error("Balalaika is missing");return b=a.fn.on,c=a.fn.off,a.extend(a.fn,{on:function(a,c){return a.split(/\s/).forEach(function(a){b.call(this,a,c)},this),this},off:function(a,b){return a.split(/\s/).forEach(function(a){c.call(this,a,b)},this),this},hasClass:function(a){return!!this[0]&&this[0][d].contains(a)},addClass:function(a){return this.forEach(function(b){var c=b[d];c.add.apply(c,a.split(/\s/))}),this},removeClass:function(a){return this.forEach(function(b){var c=b[d];c.remove.apply(c,a.split(/\s/))}),this},toggleClass:function(a,b){return this.forEach(function(c){var e=c[d];"boolean"!=typeof b&&(b=!e.contains(a)),e[b?"add":"remove"].apply(e,a.split(/\s/))}),this},add:function(b){var c,d,e=a(this),f=function(a,b){for(d=0;d<a.length;d++)if(a[d]===b)return d;
};for(b=a(b).slice(),[].push.apply(e,b),c=e.length-b.length;c<e.length;c++)([].indexOf?e.indexOf(e[c]):f(e,e[c]))!==c&&e.splice(c--,1);return e},not:function(b){var c,d,e=a(this);for(b=a(b),d=0;d<b.length;d++)~(c=e.indexOf(b[d]))&&e.splice(c,1);return e},find:function(b){var c=a();return this.forEach(function(d){c=c.add(a(b,d))}),c}}),a.parseHTML=function(b){var c,d,e=document.createElement("div"),f={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_:[0,"",""]};for(b=b.replace(/^\s+|\s+$/g,""),f.optgroup=f.option,f.tbody=f.tfoot=f.colgroup=f.caption=f.thead,f.th=f.td,c=f[/<([\w:]+)/.exec(b)[1]]||f._,e.innerHTML=c[1]+b+c[2],d=c[0];d--;)e=e.children[0];return a(e.children)},a.create=function create(a,b){var c,d,e,f;if("object"==typeof a&&(b=a,
a=b.tagName),c=document.createElement(a),b)for(d in b)if(f=b[d],"attributes"==d&&"object"==typeof f)for(e in f)f.hasOwnProperty(e)&&c.setAttribute(e,f[e]);else{if("tagName"==d)continue;if("children"==d&&f)for(e=0;e<f.length;e++)c.appendChild(create(f[e]));else if("object"==typeof c[d]&&null!==c[d]&&"object"==typeof b)for(e in f)f.hasOwnProperty(e)&&(c[d][e]=f[e]);else c[d]=f}return c},function(a,b,c,d,e,f){var g,h=a.createElement("div").children;try{[].push.apply([],h)}catch(i){g=!0}return g=g||"function"==typeof h||a.documentMode<9,g&&(f=b.i[d="prototype"],b.i=function(g,h){for(e=g?g&&g.nodeType||g==window?[g]:"string"==typeof g?/</.test(g)?((c=a.createElement("div")).innerHTML=g,c.children):(h&&b(h)[0]||a).querySelectorAll(g):!/f/.test(typeof g)||g[0]||g[0].nodeType?g:/c/.test(a.readyState)?g():!function r(b){/in/(a.readyState)?setTimeout(r,9,b):b()}(g):f,d=[],c=e?e.length:0;c--;d[c]=e[c]);f.push.apply(this,d)},b.i[d]=f,f.is=function(a){var b,c=this[0],d=c.parentNode.querySelectorAll(a);
for(b=0;b<d.length;b++)if(d[b]===c)return!0;return!1}),b}(document,a),a}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/dollar-lib",["matreshka_dir/balalaika-extended"],b):a.__DOLLAR_LIB=b(a.$b)}(this,function(a){var b,c="on off is hasClass addClass removeClass toggleClass add not find".split(/\s+/),d="function"==typeof $?$:null,e=!0;if(d){for(b=0;b<c.length;b++)if(!d.prototype[c[b]]){e=!1;break}d.parseHTML||(e=!1)}else e=!1;return e?d:a}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/binders",b):a.__MK_BINDERS=b()}(this,function(a){var b,c=function(a){return{on:null,getValue:null,setValue:a}},d=function(a,b,c){for(var d,e,f=a.length,g=0,h=0,i=[];f>h;h++)e=a[h],b?(d=new FileReader,d.onloadend=function(a){e.readerResult=d.result,i[g++]=e,g==f&&c(i)},d["readAs"+b[0].toUpperCase()+b.slice(1)](e)):(i[g++]=e,g==f&&c(i))};return b={innerHTML:function(){return c(function(a){this.innerHTML=null===a?"":a+""})},className:function(a){var b=!a.indexOf("!");
return b&&(a=a.replace("!","")),c(function(c){this.classList.toggle(a,b?!c:!!c)})},property:function(a){return c(function(b){this[a]=b})},attribute:function(a){return c(function(b){this.setAttribute(a,b)})},textarea:function(){return b.input("text")},progress:function(){return b.input()},input:function(a,b){var c;switch(a){case"checkbox":return{on:"click keyup",getValue:function(){return this.checked},setValue:function(a){this.checked=a}};case"radio":return{on:"click keyup",getValue:function(){return this.value},setValue:function(a){this.checked=this.value==a}};case"submit":case"button":case"image":case"reset":return{};case"hidden":c=null;break;case"file":c="change";break;case"text":case"password":c=8==document.documentMode?"keyup paste":"input";break;default:c="input"}return{on:c,getValue:function(){return this.value},setValue:function(a){this.value!=a&&(this.value=a)}}},select:function(a){var b;return a?{on:"change",getValue:function(){return[].slice.call(this.options).filter(function(a){
return a.selected}).map(function(a){return a.value})},setValue:function(a){for(a="string"==typeof a?[a]:a,b=this.options.length-1;b>=0;b--)this.options[b].selected=~a.indexOf(this.options[b].value)}}:{on:"change",getValue:function(){return this.value},setValue:function(a){var c,d=this;if(d.value=a,!a)for(c=d.options,b=c.length-1;b>=0;b--)c[b].value||(c[b].selected=!0)}}},visibility:function(a){return a="undefined"==typeof a?!0:a,c(function(b){this.style.display=a?b?"":"none":b?"none":""})},file:function(a){if("undefined"!=typeof FileList)return{on:function(b){var c=function(){var c=this.files;c.length?d(c,a,function(a){b(a)}):b([])};this.addEventListener("change",c)},getValue:function(a){var b=a.domEvent||[];return this.multiple?b:b[0]||null}};throw Error("file binder is not supported at this browser")},style:function(a){return{getValue:function(){return window.getComputedStyle?getComputedStyle(this,null).getPropertyValue(a):this.currentStyle[a]},setValue:function(b){this.style[a]=b}}}};
}),function(a,b){"function"==typeof define&&define.amd?define("matreshka-magic",["matreshka_dir/balalaika-extended","matreshka_dir/dollar-lib","matreshka_dir/binders"],b):a.MatreshkaMagic=b(a.$b,a.__DOLLAR_LIB,a.__MK_BINDERS)}(this,function(a,b,c){var d,e,f,g,d,h,i,j=function(a){return a._initMK?a._initMK():e.initMK(a),a},k=function(a,c){var d,f,i,j=b();return c.replace(/:sandbox/g,":bound(sandbox)").split(",").forEach(function(c){(d=/:bound\(([^(]*)\)(.*)/.exec(h(c)))?(f=a.$bound(d[1]),(i=h(d[2]))?0==i.indexOf(">")?g(f,function(a){var c=e.randomString();a.setAttribute(c,c),j=j.add(b("["+c+'="'+c+'"]'+i,a)),a.removeAttribute(c)}):j=j.add(f.find(i)):j=j.add(f)):j=j.add(c)}),j};return e={domEvents:{list:{},add:function(a){a.node&&("function"==typeof a.on?a.on.call(a.node,a.handler):b(a.node).on(a.on.split(/\s/).join(".mk ")+".mk",a.handler)),(this.list[a.instance[i].id]=this.list[a.instance[i].id]||[]).push(a)},remove:function(a){var c,d,f=this.list[a.instance[i].id];if(f)for(d=0;d<f.length;d++)c=f[d],
c.node===a.node&&(c.mkHandler&&e._off(a.instance,"_runbindings:"+a.key,c.mkHandler),"string"==typeof c.on&&b(a.node).off(c.on+".mk",c.handler),c.removed=!0,this.list[a.instance[i].id].splice(d--,1))}},initMK:function(a){return a[i]||Object.defineProperty(a,i,{value:{events:{},special:{},id:"mk"+e.randomString()},enumerable:!1,configurable:!1,writable:!1}),a},on:function(a,b,c,d,f,g){if(!a)return a;j(a);var i,k;if("object"==typeof b&&!(b instanceof Array)){for(k in b)b.hasOwnProperty(k)&&e.on(a,k,b[k],c,d);return a}if(!c)throw Error('callback is not function for event(s) "'+b+'"');for(b=b instanceof Array?b:h(b).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"boolean"!=typeof d&&"undefined"!=typeof d&&(i=f,f=d,d=i),k=0;k<b.length;k++)e._on(a,b[k],c,f,g);return d===!0&&c.call(f||a,{triggeredOnInit:!0}),a},_addListener:function(a,b,c,f,g){if(!a||"object"!=typeof a)return a;j(a);var h,k,l,m=f||a,n=a[i].events[b]||(a[i].events[b]=[]),o=n.length,p=/([^\:\:]+)(::([^\(\)]+)?(\((.*)\))?)?/,q={callback:c,
context:f,ctx:m,name:b};for(h=0;o>h;h++)if(k=n[h],(k.callback==c||k.callback==c._callback)&&k.context==f)return a;return g=g?d({},g,q):q,n.push(g),l=p.exec(b),l&&l[2]?e._addDOMListener(a,l[3]||"sandbox",l[1],l[5],c,m,g):0==b.indexOf("change:")&&e._defineSpecial(a,b.replace("change:","")),a},_removeListener:function(a,b,c,d,f){if(!a||"object"!=typeof a||!a[i]||!a[i].events)return a;var g,h,j,k=a[i].events[b]||[],l=a[i].events[b]=[],m=/([^\:\:]+)(::([^\(\)]+)(\((.*)\))?)?/,n=0,o=k.length;if(f=f||{},j=m.exec(b),j&&j[2])e._removeDOMListener(a,j[3],j[1],j[5],c,d);else{for(h=0;o>h;h++)g=k[h],((!g.howToRemove||!g.howToRemove(g,f))&&c&&c!==g.callback&&c._callback!==g.callback||d&&d!==g.context)&&(l[n++]=g);l.length||delete a[i].events[b]}return a},_delegateListener:function(a,b,c,d,f,g){if(!a||"object"!=typeof a)return a;if(j(a),0==b.indexOf("..."))return e._delegateTreeListener(a,b.replace(/^\.+/,""),c,d,f,g);var h,k=/([^\.]+)\.(.*)/.exec(b),l=k?k[1]:b;b=k?k[2]:"",0==b.indexOf("..")&&0!==b.indexOf("...")&&(b="."+b),
g=g||{},l?"*"==l?a.isMKArray?(h=function(h){(h&&h.added?h.added:a).forEach(function(a){a&&e._delegateListener(a,b,c,d,f,g)})},h._callback=d,e._addListener(a,"add",h,f,g),h()):a.isMKObject&&(h=function(h){var j=a[h.key];j&&h&&h.key in a[i].keys&&e._delegateListener(j,b,c,d,f,g)},a.each(function(a){e._delegateListener(a,b,c,d,f,g)}),h._callback=d,e._addListener(a,"change",h,f,g)):(h=function(h){if(!h||!h._silent){var j,k,m,n=a[l],o=!0;if(g.path=b,g.previousValue=h&&h.previousValue||g.previousValue&&g.previousValue[l],h&&h.previousValue&&h.previousValue[i]&&e._undelegateListener(h.previousValue,b,c,d,f,g),"object"==typeof n&&n&&e._delegateListener(n,b,c,d,f,g),0==c.indexOf("change:")&&(j=c.replace("change:",""),!b&&g.previousValue&&g.previousValue[j]!==n[j])){if(m=g.previousValue[i].events[c])for(k=0;k<m.length;k++)m[k].path===b&&(o=!1);o&&e.set(n,j,n[j],{force:!0,previousValue:g.previousValue[j],previousObject:g.previousValue,_silent:!0})}}},h._callback=d,e._addListener(a,"change:"+l,h,f,g),
h()):e._addListener(a,c,d,f,g)},_delegateTreeListener:function(a,b,c,d,f,h){if(!a||"object"!=typeof a)return a;var i;return i=function(g){var i=a[g.key];i&&(e._delegateListener(i,b,c,d,f,h),e._delegateTreeListener(i,b,c,d,f,h))},g(a,function(a){e._delegateListener(a,b,c,d,f,h),e._delegateTreeListener(a,b,c,d,f,h)}),i._callback=d,e._addListener(a,"change",i,f,h),a},_undelegateListener:function(a,b,c,d,f,g){if(!a||"object"!=typeof a)return a;if(0!=b.indexOf("...")){var h,j,k=/([^\.]+)\.(.*)/.exec(b),l=k?k[1]:b,m=b;if(b=k?k[2]:"",l)if("*"==l){if(a.isMKArray){if(d)e._undelegateListener(a,b,"add",d,f,g);else for(h=a[i].events.add||[],j=0;j<h.length;j++)h[j].path==m&&e._undelegateListener(a,b,"add",h[j].callback);a.forEach(function(a){a&&e._undelegateListener(a,b,c,d,f)})}else if(a.isMKObject){if(d)e._undelegateListener(a,b,"change",d,f);else for(h=a[i].events.change||[],j=0;j<h.length;j++)h[j].path==m&&e._undelegateListener(a,b,"change",h[j].callback);a.each(function(a){a&&e._undelegateListener(a,b,c,d,f);
})}}else{if(d)e._removeListener(a,"change:"+l,d,f,g);else for(h=a[i].events["change:"+l]||[],j=0;j<h.length;j++)h[j].path==m&&e._removeListener(a,"change:"+l,h[j].callback);"object"==typeof a[l]&&e._undelegateListener(a[l],b,c,d,f,g)}else e._removeListener(a,c,d,f,g)}},_addDOMListener:function(a,c,d,f,g,h,k){if(!a||"object"!=typeof a)return a;j(a),f=f||null,k=k||{};var l=function(d){var e,i,j=this,k=b(j),l={self:a,node:j,$nodes:k,key:c,domEvent:d,originalEvent:d.originalEvent||d,preventDefault:function(){d.preventDefault()},stopPropagation:function(){d.stopPropagation()},which:d.which,target:d.target};f?(e="x"+String(Math.random()).split(".")[1],j.setAttribute(e,e),i="["+e+'="'+e+'"] '+f,b(d.target).is(i+","+i+" *")&&g.call(h,l),j.removeAttribute(e)):g.call(h,l)},m=d+"."+a[i].id+c,n=function(a){a&&a.$nodes&&a.$nodes.on(m,l)},o=function(a){a&&a.$nodes&&a.$nodes.off(m,l)};return e._defineSpecial(a,c),n._callback=o._callback=g,e._addListener(a,"bind:"+c,n,h,k),e._addListener(a,"unbind:"+c,o,h,k),
n({$nodes:a[i].special[c]&&a[i].special[c].$nodes}),a},_removeDOMListener:function(a,b,c,d,f,g,h){return a&&"object"==typeof a&&a[i]&&a[i].events?(d=d||null,h=h||{},b&&a[i].special[b]&&(a[i].special[b].$nodes.off(c+"."+a[i].id+b),e._removeListener(a,"bind:"+b,f,g,h),e._removeListener(a,"unbind:"+b,f,g,h)),a):a},_on:function(a,b,c,d){if(!a)return a;j(a);var f,g=b.lastIndexOf("@");return~g?(f=b.slice(0,g).replace(/([^@]*)@/g,function(a,b){return(b||"*")+"."}).replace(/\.$/,".*")||"*",b=b.slice(g+1),e._delegateListener(a,f,b,c,d||a)):e._addListener(a,b,c,d),a},_off:function(a,b,c,d){if(!a)return a;j(a);var f,g=b.lastIndexOf("@");return~g?(f=b.slice(0,g),b=b.slice(g+1).replace(/@/g,"."),e._undelegateListener(a,f,b,c,d)):e._removeListener(a,b,c,d),a},once:function(a,b,c,d,f){if(!a||"object"!=typeof a)return a;if("object"==typeof b){for(g in b)b.hasOwnProperty(g)&&e.once(a,g,b[g],c,d);return a}if(!c)throw Error('callback is not function for event "'+b+'"');j(a);var g;for(b=b.split(/\s/),g=0;g<b.length;g++)!function(b){
var f=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}(c);f._callback=c,e._on(a,b,f,d)}(b[g]);return a},onDebounce:function(a,b,c,d,f,g,h){if(!a||"object"!=typeof a)return a;var i,j;if("object"==typeof b){for(j in b)b.hasOwnProperty(j)&&e.onDebounce(a,j,b[j],c,d,f,g);return a}return"number"!=typeof d&&(h=g,g=f,f=d,d=0),i=e.debounce(c,d),i._callback=c,e.on(a,b,i,f,g,h)},_defineSpecial:function(a,c){if(!a||"object"!=typeof a)return a;j(a);var d=a[i].special[c];return d||(d=a[i].special[c]={$nodes:b(),value:a[c],getter:function(){return d.value},setter:function(b){e.set(a,c,b,{fromSetter:!0})},mediator:null},Object.defineProperty(a,c,{configurable:!0,enumerable:!0,get:function(){return d.getter.call(a)},set:function(b){d.setter.call(a,b)}})),d},mediate:function(a,b,c){if(!a||"object"!=typeof a)return a;j(a);var d,f,g=typeof b;if("object"==g&&!(b instanceof Array)){for(d in b)b.hasOwnProperty(d)&&e.mediate(a,d,b[d]);return a}for(b="string"==g?b.split(/\s/):b,
d=0;d<b.length;d++)(function(b){f=e._defineSpecial(a,b),f.mediator=function(d){return c.call(a,d,f.value,b,a)},e.set(a,b,f.mediator(f.value),{fromMediator:!0})})(b[d]);return a},linkProps:function(a,b,c,d,f){if(!a||"object"!=typeof a)return a;j(a);var g,h,k,l,m,c="string"==typeof c?c.split(/\s/):c,n=function(f){var j=[],n=f._protect=f._protect||{};if(f.fromDependency=!0,!(b+a[i].id in n)){if("object"==typeof c[0])for(l=0;l<c.length;l+=2)for(g=c[l],k="string"==typeof c[l+1]?c[l+1].split(/\s/):c[l+1],m=0;m<k.length;m++)j.push(g[k[m]]);else for(l=0;l<c.length;l++)h=c[l],g=a,j.push(g[h]);n[b+a[i].id]=1,e.set(a,b,d.apply(a,j),f)}};if(d=d||function(a){return a},"object"==typeof c[0])for(l=0;l<c.length;l+=2)for(g=j(c[l]),k="string"==typeof c[l+1]?c[l+1].split(/\s/):c[l+1],m=0;m<k.length;m++)e._defineSpecial(g,k[m]),e._on(g,"_rundependencies:"+k[m],n);else for(l=0;l<c.length;l++)h=c[l],g=a,e._defineSpecial(g,h),e._on(g,"_rundependencies:"+h,n);return f!==!1&&n.call("object"==typeof c[0]?c[0]:a,{
key:"object"==typeof c[0]?c[1]:c[0]}),a},off:function(a,b,c,d){var f;if("object"==typeof b&&!(b instanceof Array)){for(f in b)b.hasOwnProperty(f)&&e.off(a,f,b[f],c);return a}if(!b&&!c&&!d)return a[i].events={},a;if(b=h(b).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"object"!=typeof a)return a;for(f=0;f<b.length;f++)a._off?a._off(b[f],c,d):e._off(a,b[f],c,d);return a},__off:function(a,b,c,d){if(!a)return a;j(a);var f,g,h,k,l,m,n,o,p,q=b.indexOf("@"),r=/^(.*?)\((.*)\)/;if(~q){if(m=b.slice(0,q),b=b.slice(q+1),c)e._off(a,"change:"+m,c,d);else for(l=a[i].events["change:"+m]||[],p=0;p<l.length;p++)l[p].flag===b&&e._off(a,"change:"+m,l[p].callback);"object"==typeof a[m]&&null!==a[m]&&e._off(a[m],b,c,d)}else if(l=a[i].events[b]){if(a[i].events[b]=h=[],c||d)for(p=0;p<l.length;p++)k=l[p],(c&&c!==k.callback&&c!==k.callback._callback||d&&d!==k.context)&&h.push(k);h.length||delete a[i].events[b],n=b.split("::"),o=n[0],m=n[1],m&&a[i].special[m]&&((g=r.exec(m))&&(f=k.selector=g[2],m=g[1]),a[i].special[m].$nodes.off(o+"."+a[i].id+m),
e._off(a,"bind:"+m,c),e._off(a,"unbind:"+m,c))}return a},trigger:function(a,b){if(!a||"object"!=typeof a||!a[i]||!a[i].events)return a;var c,d;if(b)for(c=f(arguments),b=b.split(/\s/),d=0;d<b.length;d++)c=c.slice(),e._trigger.apply(e,c);return a},_trigger:function(a,b){if(!a||"object"!=typeof a||!a[i]||!a[i].events)return a;j(a);var c,d,e,g,h=a[i].events[b];if(b&&h)for(c=f(arguments,2),d=-1,e=h.length;++d<e;)(g=h[d]).callback.apply(g.ctx,c);return a},bindNode:function(a,b,c,f,i,k){if(!a||"object"!=typeof a)return a;j(a);var l,m,n,o,p,q,r,s,t="undefined"==typeof a[b];if(b instanceof Array){for(n=0;n<b.length;n++)e.bindNode(a,b[n][0],b[n][1],b[n][2]||i,c);return a}if("string"==typeof b&&(m=h(b).split(/\s+/),m.length>1)){for(n=0;n<m.length;n++)e.bindNode(a,m[n],c,f,i);return a}if("object"==typeof b){for(n in b)b.hasOwnProperty(n)&&e.bindNode(a,n,b[n],c,f,i);return a}if(2==c.length&&!c[1].nodeName&&(c[1].setValue||c[1].getValue||c[1].on))return e.bindNode(a,b,c[0],c[1],f,i);if(p=b.indexOf("."),
~p)return q=b.split("."),r=function(b){var d=b&&b.value;if(!d){d=a;for(var g=0;g<q.length-1;g++)d=d[q[g]]}e.bindNode(d,q[q.length-1],c,f,b,k),b&&b.previousValue&&e.unbindNode(b.previousValue,q[q.length-1],c)},e._delegateListener(a,q.slice(0,q.length-2).join("."),"change:"+q[q.length-2],r),r(),a;if(l=e._getNodes(a,c),!l.length){if(k)return a;throw Error('Binding error: node is missing for key "'+b+'".'+("string"==typeof c?' The selector is "'+c+'"':""))}return i=i||{},o=e._defineSpecial(a,b),o.$nodes=o.$nodes.add(l),a.isMK&&(a.$nodes[b]=o.$nodes,a.nodes[b]=o.$nodes[0],"sandbox"==b&&(a.$sandbox=o.$nodes,a.sandbox=o.$nodes[0])),g(l,function(c){var g,h=null!==f?d("sandbox"==b?{}:e.lookForBinder(c)||{},f):{},j={self:a,key:b,$nodes:l,node:c};h.initialize&&h.initialize.call(c,d({value:o.value},j)),h.setValue&&(g=function(e){var f=a[b];e&&e.changedNode==c&&e.onChangeValue==f||h.setValue.call(c,f,d({value:f},j))},e._on(a,"_runbindings:"+b,g),!t&&g()),t&&h.getValue&&i.assignDefaultValue!==!1&&e.set(a,b,h.getValue.call(c,j),d({
fromNode:!0},i)),h.getValue&&h.on&&(s={node:c,on:h.on,instance:a,key:b,mkHandler:g,handler:function(f){if(!s.removed){var g=a[b],i=h.getValue.call(c,d({value:g,domEvent:f,originalEvent:f.originalEvent||f,preventDefault:function(){f.preventDefault()},stopPropagation:function(){f.stopPropagation()},which:f.which,target:f.target},j));i!==g&&e.set(a,b,i,{fromNode:!0,changedNode:c,onChangeValue:i})}}},e.domEvents.add(s))}),i.silent||e._trigger(a,"bind:"+b,d({key:b,$nodes:l,node:l[0]||null},i)),a},bindOptionalNode:function(a,b,c,d,f){return"object"==typeof b?e.bindNode(a,b,c,d,!0):e.bindNode(a,b,c,d,f,!0),a},unbindNode:function(a,b,c,f){if(!a||"object"!=typeof a)return a;j(a);var h,k,l,m,n,o=typeof b,p=a[i].special[b];if(b instanceof Array){for(l=0;l<b.length;l++)f=c,e.unbindNode(a,b[l][0],b[l][1]||f,f);return a}if("string"==o&&(k=b.split(/\s/),k.length>1)){for(l=0;l<k.length;l++)e.unbindNode(a,k[l],c,f);return a}if(m=b.indexOf("."),~m){n=b.split(".");for(var q=a,l=0;l<n.length-1;l++)q=q[n[l]];
return e._undelegateListener(a,n.slice(0,n.length-2),"change:"+n[n.length-2]),e.unbindNode(q,n[n.length-1],c,f),a}if(null===b){for(b in a[i].special)a[i].special.hasOwnProperty(b)&&e.unbindNode(a,b,c,f);return a}if("object"==o){for(l in b)b.hasOwnProperty(l)&&e.unbindNode(a,l,b[l],c);return a}return c?2==c.length&&!c[1].nodeName&&(c[1].setValue||c[1].getValue||c[1].on)?e.unbindNode(a,b,c[0],f):p?(h=e._getNodes(a,c),g(h,function(c,d){e.domEvents.remove({key:b,node:c,instance:a}),p.$nodes=p.$nodes.not(c)}),a.isMK&&(a.$nodes[b]=p.$nodes,a.nodes[b]=p.$nodes[0]||null,"sandbox"==b&&(a.sandbox=p.$nodes[0]||null,a.$sandbox=p.$nodes)),f&&f.silent||e._trigger(a,"unbind:"+b,d({key:b,$nodes:h,node:h[0]||null},f)),a):a:p&&p.$nodes?e.unbindNode(a,b,p.$nodes,f):a},selectAll:function(a,c){return a&&"object"==typeof a&&a.$sandbox?(j(a),/:sandbox|:bound\(([^(]*)\)/.test(c)?k(a,c):a.$sandbox.find(c)):b()},select:function(a,b){return e.selectAll(a,b)[0]||null},boundAll:function(a,c){if(!a||"object"!=typeof a)return b();
j(a);var d,e,f,g=a[i].special;if(c=c?c:"sandbox",d="string"==typeof c?c.split(/\s/):c,d.length<=1)return d[0]in g?g[d[0]].$nodes:b();for(e=b(),f=0;f<d.length;f++)e=e.add(g[d[f]].$nodes);return e},$bound:function(a,b){return e.boundAll(a,b)},bound:function(a,b){if(!a||"object"!=typeof a)return null;j(a);var c,d,e=a[i].special;if(b=b?b:"sandbox",c="string"==typeof b?b.split(/\s/):b,c.length<=1)return c[0]in e?e[c[0]].$nodes[0]||null:null;for(d=0;d<c.length;d++)if(c[d]in e&&e[c[d]].$nodes.length)return e[c[d]].$nodes[0];return null},set:function(a,b,c,f){if(!a||"object"!=typeof a)return a;var g,h,j,k,l,m,n=typeof b,o=Number.isNaN||function(a){return"number"==typeof a&&o(a)};if("undefined"==n)return a;if("object"==n){for(k in b)b.hasOwnProperty(k)&&e.set(a,k,b[k],c);return a}return a[i].special&&a[i].special[b]?(g=a[i].special[b],h=g.value,j=!g.mediator||c===h||f&&(f.skipMediator||f.fromMediator)?c:g.mediator.call(a,c,h,b,a),l={value:j,previousValue:h,key:b,node:g.$nodes[0]||null,$nodes:g.$nodes,
self:a},f=f?d(l,f):l,m=(j!==h||f.force)&&!f.silent,m&&(e._trigger(a,"beforechange:"+b,f),e._trigger(a,"beforechange",f)),g.value=j,(j!==h||f.force||f.forceHTML||j!==c&&!o(j))&&(f.silentHTML||e._trigger(a,"_runbindings:"+b,f)),m&&(e._trigger(a,"change:"+b,f),e._trigger(a,"change",f)),j===h&&!f.force&&!f.forceHTML||f.skipLinks||e._trigger(a,"_rundependencies:"+b,f),a):(a[b]=c,a)},_parseBindings:function(a,c){if(!a||"object"!=typeof a)return null;j(a);var d="string"==typeof c?e.$.parseHTML(c.replace(/^\s+|\s+$/g,"")):b(c),f=d.find("*").add(d);return g(f,function(a){!function f(a){"TEXTAREA"!==a.tagName&&g(a.childNodes,function(b){var c,d=b.previousSibling;3==b.nodeType&&~b.nodeValue.indexOf("{{")?(c=b.nodeValue.replace(/{{([^}]*)}}/g,'<mk-bind mk-html="$1"></mk-bind>'),d?d.insertAdjacentHTML("afterend",c):a.insertAdjacentHTML("afterbegin",c),a.removeChild(b)):1==b.nodeType&&f(b)})}(a)}),f=d.find("*").add(d),g(f,function(b){var c=b.getAttribute("mk-html");c&&(e.bindNode(a,c,b,e.binders.innerHTML()),
b.removeAttribute("mk-html")),g(b.attributes,function(c){var d,f,g=h(c.value),i=c.name;~g.indexOf("{{")&&(d=g.match(/{{[^}]*}}/g).map(function(a){return a.replace(/{{(.*)}}/,"$1")}),1==d.length&&/^{{[^}]*}}$/g.test(g)?f=d[0]:(f=e.randomString(),e.linkProps(a,f,d,function(){var b=g;return d.forEach(function(c){b=b.replace(new RegExp("{{"+c+"}}","g"),a[c])}),b})),("value"==i&&"checkbox"!=b.type||"checked"==i&&"checkbox"==b.type)&&e.lookForBinder(b)?e.bindNode(a,f,b):e.bindNode(a,f,b,e.binders.attribute(i)))})}),d},remove:function(a,b,c){if(!a||"object"!=typeof a||!a[i]||!a[i].special)return null;var f,g,b,h=String(b).split(/\s/);for(c=d({keys:h},c),g=0;g<h.length;g++)if(b=h[g],f=b in a){c.key=b,c.value=a[b],e.unbindNode(a,b),e.off("change:"+b+" beforechange:"+b+" _runbindings:"+b+" _rundependencies:"+b),delete a[i].special[b];try{delete a[b]}catch(j){}c&&c.silent||(e._trigger(a,"delete",c),e._trigger(a,"delete:"+b,c))}return a},_getNodes:function(a,c){return"string"==typeof c&&!/</.test(c)&&/:sandbox|:bound\(([^(]*)\)/.test(c)?k(a,c):b(c);
},trim:h=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},toArray:f=function(a,b){var c,d=[],e=a.length;for(b=b||0,c=b;e>c;c++)d[c-b]=a[c];return d},extend:d=function(a,b){var c,d;if(a)for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a},each:g=function(a,b,c){if(a){if(a.isMK&&"function"==typeof a.each)a.each(b,c);else if("length"in a)[].forEach.call(a,b,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}},randomString:function(){return((new Date).getTime()-new Date(2013,4,3).getTime()).toString(36)+Math.floor(1679616*Math.random()).toString(36)},binders:c,defaultBinders:[function(a){var b,d=a.tagName;return"INPUT"==d?b=c.input(a.type):"TEXTAREA"==d?b=c.textarea():"SELECT"==d?b=c.select(a.multiple):"PROGRESS"==d&&(b=c.progress()),b}],lookForBinder:function(a){var b,c,d=e.defaultBinders;for(c=0;c<d.length;c++)if(b=d[c].call(a,a))return b},debounce:function(a,b,c){var d;return"number"!=typeof b&&(c=b,b=0),
function(){var e=arguments,f=this;clearTimeout(d),d=setTimeout(function(){a.apply(c||f,e)},b||0)}},noop:function(){},$:b,$b:a,useAs$:function(a){return e.$=this.$=b=a}},i=e.sym="undefined"==typeof Symbol?"mk-"+e.randomString():Symbol("matreshka"),e}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/matreshka-core",["xclass","matreshka-magic"],b):a.MK=a.Matreshka=b(a.Class,a.MatreshkaMagic)}(this,function(a,b){if(!a)throw Error("Class function is missing");if(![].forEach)throw Error("Internet Explorer 8 requires to use es5-shim: https://github.com/es-shims/es5-shim");var c=(b.toArray,b.extend),d=a({isMK:!0,isMKInitialized:!1,on:function(a,c,d,e,f){return b.on(this,a,c,d,e,f)},onDebounce:function(a,c,d,e,f,g){return b.onDebounce(this,a,c,d,e,f,g)},_on:function(a,c,d,e){return b._on(this,a,c,d,e)},once:function(a,c,d){return b.once(this,a,c,d)},off:function(a,c,d){return b.off(this,a,c,d)},_off:function(a,c,d){return b._off(this,a,c,d)},trigger:function(){var a=b.toArray(arguments);
return a.unshift(this),b.trigger.apply(b,a)},_trigger:function(){var a=b.toArray(arguments);return a.unshift(this),b._trigger.apply(b,a)},bindNode:function(a,c,d,e,f){return b.bindNode(this,a,c,d,e,f)},bindOptionalNode:function(a,c,d,e){return b.bindOptionalNode(this,a,c,d,e)},unbindNode:function(a,c,d){return b.unbindNode(this,a,c,d)},boundAll:function(a){return b.boundAll(this,a)},$bound:function(a){return b.boundAll(this,a)},bound:function(a){return b.bound(this,a)},selectAll:function(a){return b.selectAll(this,a)},$:function(a){return b.selectAll(this,a)},select:function(a){return b.select(this,a)},_defineSpecial:function(a){return b._defineSpecial(this,a)},eq:function(a){return"object"==typeof a&&null!==a&&this.__id==a.__id},defineGetter:function(a,b){var c,d,e=this._initMK();if("object"==typeof a){for(d in a)a.hasOwnProperty(d)&&e.defineGetter(d,a[d]);return e}return c=e._defineSpecial(a),c.getter=function(){return b.call(e,{value:c.value,key:a,self:e})},e},defineSetter:function(a,b){
var c,d=this._initMK();if("object"==typeof a){for(c in a)a.hasOwnProperty(c)&&d.defineSetter(c,a[c]);return d}return d._defineSpecial(a).setter=function(c){return b.call(d,c,{value:c,key:a,self:d})},d},mediate:function(a,c){return b.mediate(this,a,c)},linkProps:function(a,c,d,e){return b.linkProps(this,a,c,d,e)},get:function(a){return this[a]},set:function(a,c,d){return b.set(this,a,c,d)},remove:function(a,c){return b.remove(object,a,c)},define:function(a,b){var c,d=this;if("object"==typeof a){for(c in a)d.define(c,a[c]);return d}return Object.defineProperty(d,a,b),d},delay:function(a,b,c){var d=this;return"object"==typeof b&&(c=b,b=0),setTimeout(function(){a.call(c||d)},b||0),d},_initMK:function(){var a=b.initMK(this);return a.nodes=a.nodes={},a.$nodes=a.$nodes={},a.sandbox=a.sandbox||null,a.$sandbox=a.$sandbox||d.$(),this},toString:function(){return"[object Matreshka]"},constructor:function Matreshka(){this._initMK()},getAnswerToTheUltimateQuestionOfLifeTheUniverseAndEverything:function(){
this.delay(function(){alert(42)},236682e12)}});return c(d,b,{version:"dev",Class:a,isXDR:a.isXDR,to:function to(a){var b,c;if("object"==typeof a)if("length"in a){for(b=[],c=0;c<a.length;c++)b[c]=to(a[c]);b=(new d.Array).recreate(b)}else{b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=to(a[c]));b=new d.Object(b)}else b=a;return b}}),d}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/matreshka-object",["matreshka_dir/matreshka-core"],b):b(a.MK)}(this,function(a){if(!a)throw new Error("Matreshka is missing");var b,c=a.sym,d={"extends":a,isMKObject:!0,renderer:null,constructor:function MatreshkaObject(a){this.jset(a)},keys:function(){var a,b=this._initMK(),d=b[c].keys,e=[];for(a in d)d.hasOwnProperty(a)&&e.push(a);return e},_initMK:function(){var b=this;return b[c]?b:(a.prototype._initMK.call(b,arguments),b[c].keys={},b._on("delete",function(a){a&&a.silent||b._trigger("modify",a)})._on("change",function(a){a&&a.key in b[c].keys&&!a.silent&&b._trigger("modify",a)}))},hasOwnProperty:function(a){
return this._initMK()[c].keys.hasOwnProperty(a)},toObject:function(){var a,b=this._initMK(),d={},e=b[c].keys;for(a in e)e.hasOwnProperty(a)&&(d[a]=b[a]);return d},toNative:function(){return this.toObject()},toJSON:function(){var a,b=this._initMK(),d={},e=b[c].keys;for(a in e)e.hasOwnProperty(a)&&(d[a]=b[a]&&b[a].toJSON?b[a].toJSON():b[a]);return d},keyOf:function(a){var b,d=this._initMK(),e=d[c].keys;for(b in e)if(e.hasOwnProperty(b))if(a&&a.isMK){if(a.eq(d[b]))return b}else if(a===d[b])return b;return null},jset:function(a,d,e){var f=this._initMK(),g=typeof a;if("undefined"==g)return f;if("object"==g){a=a.toJSON?a.toJSON():a;for(b in a)f.jset(b,a[b],d);return f}return f[c].keys[a]=1,f._defineSpecial(a),f.set(a,d,e)},remove:function(b,c){return this.removeDataKeys(b),a.prototype.remove.call(this,b,c)},addDataKeys:function(a){var d=this._initMK();if(!arguments.length)return d;for(a=arguments.length>1?arguments:a instanceof Array?a:String(a).split(/\s/),b=0;b<a.length;b++)d[c].keys[a[b]]=1,
d._defineSpecial(a[b]);return d},removeDataKeys:function(a){var d=this._initMK();if(!arguments.length)return d;for(a=arguments.length>1?arguments:a instanceof Array?a:String(a).split(/\s/),b=0;b<a.length;b++)delete d[c].keys[a[b]];return d},each:function(a,b){var d,e=this._initMK();for(d in e[c].keys)e[c].keys.hasOwnProperty(d)&&a.call(b,e[d],d,e);return e}};return d["undefined"!=typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var a=this,b=a.keys(),c=0;return{next:function(){return c>b.length-1?{done:!0}:{done:!1,value:a[b[c++]]}}}},a.Object=a.Class(d)}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/matreshka-array",["matreshka_dir/matreshka-core","matreshka-magic"],b):b(a.MK,a.MatreshkaMagic)}(this,function(a,b){if(!a)throw new Error("Matreshka is missing");var c=Array.prototype,d=a.sym,e=c.slice,f=a.isXDR,g=function(a,b,c,d){if(a.length!=b.length)return!1;for(c=0,d=a.length;d>c;c++)if(a[c]&&a[c].isMK?!a[c].eq(b[c]):a[c]!==b[c])return!1;return!0},h=f?function(a){
var b,c,d=this,e=d.length,f=a&&a.isMK;for(b=0;e>b;b++)if(c=d[b],f?a.eq(c):a===c)return b;return-1}:c.indexOf,i=f?function(a){var b,c,d=this,e=d.length,f=a&&a.isMK;for(b=e-1;b>=0;b--)if(c=d[b],f?a.eq(c):a===c)return b;return-1}:c.lastIndexOf,j=function(a,b,c){if(a[d].events.addone)for(c=0;c<b.length;c++)a._trigger("addone",{self:a,added:b[c]})},k=function(a,b,c){if(a[d].events.removeone)for(c=0;c<b.length;c++)a._trigger("removeone",{self:a,removed:b[c]})},l=function(a,b){b=b||[];var c,d=a.length-b.length;for(c=0;c<b.length;c++)a[c]=b[c];for(c=0;d>c;c++)a.remove(c+b.length,{silent:!0});return a.length=b.length,a},m=function(b,d){var g;switch(b){case"forEach":return function(){var a=this;return c[b].apply(f?a.toArray():a,arguments),a};case"map":case"filter":case"slice":return function(){var d=this;return a.Array.from(c[b].apply(f?d.toArray():d,arguments))};case"every":case"some":case"reduce":case"reduceRight":case"toString":case"join":return function(){var a=this;return c[b].apply(f?a.toArray():a,arguments);
};case"sort":case"reverse":return function(){var g=this,h=arguments,i=e.call(h,0,d?-1:h.length),j=d?h[h.length-1]||{}:{},k=g.toArray(),m=c[b].apply(k,i);return f?(k=g.toArray(),m=c[b].apply(k,i),l(g,k)):m=c[b].apply(g,i),j=a.extend({returns:m,args:i,originalArgs:e.call(h),method:b,self:g,added:[],removed:[]},j),j.silent||g._trigger(b,j)._trigger("modify",j),j.dontRender||g.processRendering(j),g};case"pop":case"shift":return function(){if(this.length){var g,h,i,m,n=this,o=arguments,p=e.call(o,0,d?-1:o.length),q=d?o[o.length-1]||{}:{};return f?(g=n.toArray(),h=c[b].apply(g,p),l(n,g)):h=c[b].apply(n,p),q=a.extend({returns:h,args:p,originalArgs:e.call(o),method:b,self:n,added:i="push"==b||"unshift"==b?p:[],removed:m="pop"==b||"shift"==b?[h]:[]},q),q.silent||(n._trigger(b,q),i.length&&(n._trigger("add",q),j(n,i)),m.length&&(n._trigger("remove",q),k(n,m)),n._trigger("modify",q)),q.dontRender||n.processRendering(q),h}};case"push":case"unshift":return function(){var h,i,m,n,o=this,p=arguments,q=e.call(p,0,d?-1:p.length),r=d?p[p.length-1]||{}:{};
if(!q.length)return o.length;if(!r.skipMediator&&"function"==typeof o._itemMediator&&("unshift"==b||"push"==b))for(g=0;g<q.length;g++)q[g]=o._itemMediator.call(o,q[g],g);return f?(h=o.toArray(),i=c[b].apply(h,q),l(o,h)):i=c[b].apply(o,q),r=a.extend({returns:i,args:q,originalArgs:e.call(p),method:b,self:o,added:m="push"==b||"unshift"==b?q:[],removed:n="pop"==b||"shift"==b?[i]:[]},r),r.silent||(o._trigger(b,r),m.length&&(o._trigger("add",r),j(o,m)),n.length&&(o._trigger("remove",r),k(o,n)),o._trigger("modify",r)),r.dontRender||o.processRendering(r),i};case"splice":return function(){var h,i,m,n=this,o=arguments,p=e.call(o,0,d?-1:o.length),q=d?o[o.length-1]||{}:{},r=e.call(p,2);if(!q.skipMediator&&"function"==typeof n._itemMediator)for(g=2;g<p.length;g++)p[g]=n._itemMediator.call(n,p[g],g);return f?(h=n.toArray(),i=c[b].apply(h,p),l(n,h)):i=c[b].apply(n,p),m=i,(r.length||m.length)&&(q=a.extend({returns:i,args:p,originalArgs:e.call(o),method:b,self:n,added:r,removed:m},q),q.silent||(n._trigger(b,q),
r.length&&(n._trigger("add",q),j(n,r)),m.length&&(n._trigger("remove",q),k(n,m)),n._trigger("modify",q)),q.dontRender||n.processRendering(q)),a.Array.from(i)}}},n={"extends":a,isMKArray:!0,length:0,itemRenderer:null,renderIfPossible:!0,useBindingsParser:!1,Model:null,constructor:function MatreshkaArray(a){var b,c=this._initMK(),d=arguments.length;if(1==d&&"number"==typeof a)c.length=a;else{for(b=0;d>b;b++)c[b]=arguments[b];c.length=arguments.length}},mediateItem:function(a){var b,c=this,d=c.length;for(c._itemMediator=a,b=0;d>b;b++)c[b]=a.call(c,c[b],b);return c},recreate:function(b,c){b=b||[];var d,e,f,g,i,l=this,m=l.length-b.length,n=l.toArray();if(c=c||{},l._itemMediator&&!c.skipMediator){for(d=[],e=0;e<b.length;e++)d[e]=l._itemMediator.call(l,b[e],e);b=d}for(e=0;e<b.length;e++)l[e]=b[e];for(e=0;m>e;e++)l.remove(e+b.length,{silent:!0});return l.length=b.length,c.silent&&c.dontRender?l:(i=l.toArray(),g=n.length?n.filter(function(a){return!~h.call(i,a)}):[],f=i.length?i.filter(function(a){
return!~h.call(n,a)}):[],c=a.extend({added:f,removed:g,was:n,now:i,method:"recreate",self:l},c),c.silent||(f.length&&(l._trigger("add",c),j(l,f)),g.length&&(l._trigger("remove",c),k(l,g)),(f.length||g.length)&&l._trigger("recreate",c)._trigger("modify",c)),c.dontRender||l.processRendering(c),l)},toArray:function(){var a,b=this,c=[],d=b.length;for(c=[],a=0;d>a;a++)c[a]=b[a];return c},toNative:function(){return this.toArray()},_initMK:function(){var b,c=this;return c[d]?c:(b=function(){var a=c.Model;a&&c.mediateItem(function(b){return b&&b.isMK&&b.instanceOf(a)?b:new a(b&&b.toJSON?b.toJSON():b,c)})},a.prototype._initMK.call(c),c._on("change:Model",b),b(),c)},_renderOne:function(c,e){var f,g,h=this,i=h[d].id,j=c.renderer||h.itemRenderer,k=j===c.renderer?c:h,l=c.bound(i);if(c[i]||(c[i]=h),e.moveSandbox&&(l=c.bound("sandbox"))&&c.bindNode(i,l),!l){if("function"==typeof j&&(j=j.call(k,c)),"string"!=typeof j||~j.indexOf("<")||~j.indexOf("{{"))g=j;else{if(g=k._getNodes(j),!(g=g&&g[0]))throw Error("renderer node is missing: "+j);
g=g.innerHTML}f=h.useBindingsParser?b._parseBindings(c,g):"string"==typeof g?a.$.parseHTML(g.replace(/^\s+|\s+$/g,"")):a.$(g),c.bindRenderedAsSandbox!==!1&&f.length&&c.bindNode("sandbox",f),c.bindNode(i,f),c._trigger("render",{node:f[0],$nodes:f,self:c,parentArray:h}),l=f[0]}return l},processRendering:function(a){var b,c,e,f=this,g=f[d].id,h=f.length,i=i=f.bound("container")||f.bound(),j=function(a){if(a&&a.isMK){var b=a.bound(g);return a.remove(g,{silent:!0}),b}},k=function(b){return b&&b.isMK&&f.renderIfPossible&&i&&!a.dontRender&&(f.itemRenderer||b&&b.renderer)&&f._renderOne(b,a)};switch(a.method){case"push":for(c=h-a.added.length;h>c;c++)(b=k(f[c]))&&i.appendChild(b);break;case"unshift":for(c=a.added.length-1;c+1;c--)(b=k(f[c]))&&(i.children?i.insertBefore(b,i.firstChild):i.appendChild(b));break;case"pull":case"pop":case"shift":for(c=0;c<a.removed.length;c++)(b=j(a.removed[c]))&&i.removeChild(b);break;case"sort":case"reverse":for(c=0;h>c;c++)e=f[c],(b=e&&e.isMK&&e.bound(g))&&i.appendChild(b);
break;case"rerender":for(c=0;h>c;c++)(b=k(f[c]))&&i.appendChild(b);break;case"recreate":case"splice":for(c=0;c<a.removed.length;c++)(b=j(a.removed[c]))&&i.removeChild(b);for(c=0;h>c;c++)(b=k(f[c]))&&i.appendChild(b)}return f},rerender:function(){return this.processRendering({method:"rerender"})},hasOwnProperty:function(a){return"length"==a||a<this.length&&a>=0},toJSON:function(){var a,b=this,c=[],d=b.length;for(a=0;d>a;a++)b[a]&&b[a].toJSON?c.push(b[a].toJSON()):c.push(b[a]);return c},concat:function(){var b,c,d,e=arguments,f=this.toArray();for(c=0;c<e.length;c++)if(b=e[c],b instanceof Array||b&&b.instanceOf&&b.instanceOf(a.Array))for(d=0;d<b.length;d++)f.push(b[c]);return a.Array.from(f)},pull:function(b,c){var d,e,f=this,h=f.toArray(),i=b,j=typeof b;return"number"==j||"string"==j||(b=f.indexOf(b),~b)?(d=h.splice(b,1)[0]||null,g(h,f)||(c=c||{},l(f,h,c),c=a.extend({returns:d,args:[i],method:"pull",self:f,added:[],removed:e=d?[d]:[]},c),c.silent||(f._trigger("pull",c),f._trigger("remove",c),
k(f,e),f._trigger("modify",c)),f.processRendering(c)),d):null},indexOf:h,lastIndexOf:i};return"push pop unshift shift sort reverse splice map filter slice every some reduce reduceRight forEach toString join".split(" ").forEach(function(a){n[a]=m(a)}),"push pop unshift shift sort reverse splice".split(" ").forEach(function(a){n[a+"_"]=m(a,1)}),n.each=n.forEach,n["undefined"!=typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var a=this,b=0;return{next:function(){return b>a.length-1?{done:!0}:{done:!1,value:a[b++]}}}},a.Array=a.Class(n),a.Array.of=function(){var b,c=new a.Array,d=arguments;for(c.length=d.length,b=0;b<d.length;b++)c[b]=d[b];return c},a.Array.from=function(b,c,d){var e,f=new a.Array;for(f.length=b.length,e=0;e<b.length;e++)f[e]=c?c.call(d,b[e],e,b):b[e];return f},a.Array}),"function"==typeof define&&define.amd&&define("matreshka",["matreshka_dir/matreshka-core","matreshka_dir/matreshka-object","matreshka_dir/matreshka-array"],function(a,b,c,d){return a}),"function"==typeof define&&define.amd?define(["matreshka"],function(a){
return a.version="1.0.6",a}):(Matreshka.version="1.0.6","object"==typeof exports&&(module.exports=Matreshka));
//# sourceMappingURL=matreshka.min.map